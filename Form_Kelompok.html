<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nilai Kelompok MPS</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
  :root{
    --accent:#2563eb; --success:#16a34a;
    --c1:#dce4ff; --c2:#ebf7a9; --c3:#fcc6f7; --c4:#fffbea; --c5:#f5f3ff;
    --v1:#be185d; --v2:#1e40af; --v3:#059669; --v4:#b45309; --v5:#6d28d9;
  }
  @media (min-width: 769px) {
  body {
  transform: scale(0.8);
  transform-origin: top left;
  width: 125%; /* kompensasi supaya lebar tetap proporsional */
  overflow: hidden;
  margin: 0;
  padding: 0;
  background: #e6f0fa; /* tetap lembut seperti aslinya */
  }
}
  body{font-family:"Segoe UI",sans-serif;margin:0;padding:20px;
       background:linear-gradient(135deg,#e0f2fe 0%,#fef9c3 100%);}
  .container{max-width:900px;margin:0 auto;background:#b3fdf3;border-radius:12px;
             padding:16px;box-shadow:0 6px 20px rgba(0,0,0,0.1);}
  h2.title-main{font-size:1.5rem;font-weight:950;text-align:center;margin:0;
  text-shadow:2px 2px 3px rgba(0,0,0,0.25);}
  h2.title-sub{font-size:1rem;font-weight:600;text-align:center;margin:2px 0 10px 0;}

  .top-container{display:flex;justify-content:space-between;align-items:flex-start;
    gap:8px;padding:12px;border:3px solid #000000;border-radius:8px;background:#d9fcd9;margin-bottom:4px;}
  .form-left{flex:1;display:flex;flex-direction:column;gap:5px;margin-top:5px}
  .form-pos{flex:0 0 auto;margin-left:4px;}
  .form-left input,.form-left select,.form-pos select{
    width:100%;box-sizing:border-box;padding:8px;border-radius:6px;border:1px solid #ccc;}
  .form-pos label {
  display:block;       /* penting */
  width:100%;          /* biar ikut memenuhi lebar parent */
  font-size:0.6rem;
  font-weight:600;
  text-align:center;   /* baru benarÂ² center */
  color:#444;
  margin:0;            /* buang margin-left yang ganggu */
}
  .form-pos select{font-size:2rem;font-weight:800;padding:10px 12px;min-width:3ch;text-align:center;}

  .rubrik{display:grid;gap:4px;}
  .aspek-card{display:flex;align-items:center;justify-content:space-between;
    border-radius:10px;padding:10px;box-shadow:0 4px 12px rgba(0,0,0,0.06);}
  .left{flex:1;margin-right:8px;}
  .aspek-title{font-weight:700;font-size:1rem;margin-bottom:3px;}
  .indikator{font-size:0.62rem;margin-bottom:6px;color:#222;line-height:1.2;}
  .nilai-buttons{display:flex;gap:1px;flex-wrap:wrap;}
  .nilai-buttons button {
    padding: 8px 14px;border-radius: 6px;border: 1px solid #aaa;
    background: #f9f9f9;font-weight: 700;font-size: 0.9rem;cursor: pointer;
    box-shadow: inset 2px 2px 5px rgba(0,0,0,0.4),
                inset -2px -2px 5px rgba(255,255,255,0.7);
    transition: all 0.2s ease-in-out;
  }
  .nilai-buttons button:hover {
    box-shadow: inset 3px 3px 6px rgba(0,0,0,0.5),
                inset -3px -3px 6px rgba(255,255,255,0.8);
  }
  .nilai-buttons button.active {
    background: var(--accent);color: #fff;
    box-shadow: inset 2px 2px 6px rgba(0,0,0,0.6),
                inset -2px -2px 6px rgba(255,255,255,0.3);
  }
  .nilai-besar {font-size: 3.8rem;font-weight: 900;text-align: center;min-width: 1ch;color: #333;
    text-shadow: 2px 2px 3px rgba(0,0,0,0.4),-2px -2px 3px rgba(255,255,255,0.9);}
  .nilai-besar.hidden {opacity: 0.25;color: #777;text-shadow: none;}

  .controls-row{display:flex;gap:6px;margin-top:10px;justify-content:center;}
  .controls-row .btn {
    flex: 1;max-width: 120px;padding: 8px 0;border-radius: 6px;border: none;
    font-weight: 700;font-size: 0.85rem;cursor: pointer;text-align: center;
    box-shadow: inset 2px 2px 5px rgba(0,0,0,0.4),
                inset -2px -2px 5px rgba(255,255,255,0.7);
    transition: all 0.2s ease-in-out;
  }
  .controls-row .btn:hover {transform: scale(1.05);}
  .btn-home{background:#60a5fa;color:#fff;}
  .btn-undi{background:#facc15;color:#111;}
  .btn-reset{background:#eef2ff;color:#111;border:1px solid #c7d2fe;}
  .btn-submit{background:var(--success);color:#fff;}
</style>
</head>
<body>
<div class="container">
  <h2 class="title-main">NILAI KELOMPOK</h2>
  <h2 class="title-sub">PENDIDIKAN DAN LATIHAN</h2>

  <div class="top-container">
    <div class="form-left">
      <input id="nama" type="text" maxlength="20" placeholder="NAMA KETUA">
      <select id="anggota">
        <option value="">-- Pilih Kelompok --</option>
        <option value="Kelompok 1">Kelompok 1</option>
        <option value="Kelompok 2">Kelompok 2</option>
        <option value="Kelompok 3">Kelompok 3</option>
        <option value="Kelompok 4">Kelompok 4</option>
        <option value="Kelompok 5">Kelompok 5</option>
        <option value="Kelompok 6">Kelompok 6</option>
        <option value="Kelompok 7">Kelompok 7</option>
        <option value="Kelompok 8">Kelompok 8</option>
        <option value="Kelompok 9">Kelompok 9</option>
        <option value="Kelompok 10">Kelompok 10</option>

      </select>
    </div>
    <div class="form-pos">
      <label for="pos">POS</label>
      <select id="pos">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>
  </div>

  <div id="rubrik-body" class="rubrik"></div>

  <div class="controls-row">
    <button onclick="window.top.location.href='https://andes-web.github.io/mpsmobile/index.html'" class="btn btn-home">HOME</button>
    <button id="submitBtn" class="btn btn-submit">SUBMIT</button>
    <button id="resetBtn" class="btn btn-reset">RESET</button>
    <button id="downloadExcel" class="btn btn-undi">UNDUH</button>
  </div>
</div>

<script>
const scriptURL="https://script.google.com/macros/s/AKfycby0rKtfwleVJes0fUNuwziSaqOXKxjRBh8_R-FnVuGYM5TqWH2NDiAPQj9LWyYA4IZs/exec";

/* ==== Data Rubrik ==== */
const rubrik={1:[{aspek:"Kekompakan Formasi",indikator:`1: Tidak terbentuk formasi yang jelas<br>2: Formasi terbentuk sebagian namun tidak rapi<br>3: Formasi terbentuk rapi tapi masih belum seragam<br>4: Formasi seragam, rapi, dan konsisten<br>5: Formasi sangat seragam, rapi, dengan koordinasi yang cepat dan tepat.`},
{aspek:"Kerja Sama & Koordinasi",indikator:`1: Tidak ada kerja sama, tiap anggota bergerak sendiri<br>2: Ada sebagian bekerja sama namun tidak konsisten<br>3: Mayoritas bekerja sama, meskipun masih ada kesalahan koordinasi.<br>4: Seluruh anggota bekerja sama, koordinasi cukup baik<br>5: Seluruh anggota bekerja sama kompak, saling menguatkan dan koordinasi sangat baik`},
{aspek:"Ketekunan & Daya Juang",indikator:`1: Kelompok mudah menyerah, tidak menyelesaikan tantangan<br>2: Kelompok berusaha tapi cepat lelah dan kehilangan fokus<br>3: Kelompok berusaha menyelesaikan meskipun ada kendala<br>4: Kelompok berusaha keras, gigih, dan menyelesaikan tugas<br>5: Kelompok gigih, penuh semangat, saling menyemangati hingga menyelesaikan dengan hasil terbaik`}],
2:[{aspek:"Kekompakan Diskusi",indikator:`1: Tidak ada diskusi kelompok, semua diam/bergerak sendiri<br>2: Diskusi terjadi tetapi hanya sebagian kecil yang terlibat<br>3: Diskusi melibatkan sebagian besar anggota namun belum terarah<br>4: Diskusi melibatkan semua anggota, cukup terarah dan fokus<br>5: Diskusi melibatkan semua anggota, sangat terarah, fokus, dan saling menghargai pendapat`},
{aspek:"Kolaborasi Penyusunan Puzzle",indikator:`1: Tidak ada kerja sama, puzzle dikerjakan individu<br>2: Ada sebagian anggota yang membantu tapi tidak kompak<br>3: Sebagian besar anggota terlibat namun masih tumpang tindih<br>4: Semua anggota berperan sesuai bagian masing-masing dengan baik<br>5: Semua anggota berperan optimal, saling melengkapi, dan menyelesaikan puzzle secara harmonis`},
{aspek:"Strategi Kelompok",indikator:`1: Tidak ada strategi jelas, hanya coba-coba<br>2: Strategi sederhana, belum terkoordinasi.<br>3: Strategi mulai terarah namun masih kurang efektif<br>4: Strategi sistematis, efektif, dan kooperatif<br>5: Strategi kreatif, inovatif, efisien, dan menunjukkan kepemimpinan kelompok yang baik`}],
3:[{aspek:"Kerja Sama Tim Penyelamatan",indikator:`1: Anggota tidak bekerja sama, saling berjalan sendiri<br>2: Ada sebagian yang bekerja sama tapi tidak terarah<br>3: Mayoritas anggota mulai bekerja sama, meski masih ada tumpang tindih<br>4: Semua anggota bekerja sama secara terarah dan cukup efektif<br>5: Semua anggota bekerja sama sangat solid, saling melengkapi, dan bergerak kompak sesuai peran`},
{aspek:"Efektivitas Tindakan Penyelamatan",indikator:`1: Tindakan penyelamatan tidak jelas atau tidak terkoordinasi<br>2: Ada tindakan penyelamatan dasar namun tidak efektif.<br>3: Tindakan penyelamatan dilakukan dengan sebagian langkah benar<br>4: Tindakan penyelamatan dilakukan sesuai prosedur, cukup efektif<br>5: Tindakan penyelamatan dilakukan cepat, tepat, efektif, dan menyeluruh`},
{aspek:"Komunikasi & Koordinasi Kelompok",indikator:`1: Tidak ada komunikasi antar anggota.<br>2: Komunikasi terjadi tapi membingungkan/tidak jelas<br>3: Komunikasi cukup jelas, namun belum semua anggota mendengar/ikut.<br>4: Komunikasi jelas, koordinasi cukup baik antar anggota.<br>5: Komunikasi sangat jelas, semua anggota terkoordinasi penuh dengan pembagian peran efektif.`}],
4:[{aspek:"Diskusi Kelompok",indikator:`1: Tidak ada diskusi atau tidak membahas nilai juang<br>2: Diskusi terjadi namun hanya membahas 1 nilai secara dangkal<br>3: Diskusi membahas beberapa nilai, namun masih terpisah-pisah<br>4: Diskusi membahas beberapa nilai dengan saling mengaitkan pengalaman kelompok<br>5: Diskusi membahas nilai juang secara mendalam, menyeluruh, dan terhubung dengan kehidupan nyata kelompok`},
{aspek:"Refleksi Bersama",indikator:`1: Tidak ada refleksi bersama<br>2: Refleksi dilakukan oleh sedikit anggota saja<br>3: Refleksi dilakukan sebagian besar anggota, tapi belum terarah<br>4: Refleksi dilakukan semua anggota dengan alur cukup jelas<br>5: Refleksi dilakukan seluruh anggota dengan sistematis, mendalam, dan menghasilkan kesimpulan kolektif.`},
{aspek:"Kreativitas Ekspresi",indikator:`1: Tidak ada ekspresi<br>2: Ekspresi sangat sederhana (misalnya hanya lisan tanpa penjelasan)<br>3: Ekspresi cukup jelas tetapi terbatas (misalnya poster/tulisan singkat)<br>4: Ekspresi kreatif melalui media (tulisan, yel-yel, simbol) dengan makna jelas.<br>5: Ekspresi sangat kreatif & inspiratif melalui berbagai media (lagu, drama, poster, aksi nyata) yang mewakili nilai juang kelompok`}],
5:[{aspek:"Kolaborasi Perumusan Strategi",indikator:`1: Tidak ada perumusan strategi kelompok<br>2: Hanya sebagian kecil anggota terlibat dalam merumuskan strategi<br>3: Mayoritas anggota terlibat, namun strategi masih belum terarah<br>4: Semua anggota terlibat, strategi cukup sistematis & realistis<br>5: Semua anggota aktif terlibat, strategi inovatif, kreatif, dan adaptif.`},
{aspek:"Efektivitas Implementasi Strategi",indikator:`1: Strategi tidak dapat diterapkan.<br>2: Strategi diterapkan tetapi hasilnya tidak efektif.<br>3: Strategi diterapkan dengan hasil sebagian sesuai target<br>4: Strategi diterapkan dengan hasil efektif, sesuai target<br>5: Strategi diterapkan sangat efektif, mencapai target dengan efisiensi tinggi`},
{aspek:"Inovasi & Dampak Tim",indikator:`1: Tidak ada inovasi atau dampak terlihat.<br>2: Dampak sangat terbatas, inovasi minim<br>3: Dampak cukup terlihat, ada sedikit inovasi<br>4: Dampak signifikan dengan inovasi sederhana<br>5: Dampak besar, inovasi tinggi, mampu memberi inspirasi/ide baru bagi kelompok lain.`}],
};
const cardColors=['var(--c1)','var(--c2)','var(--c3)','var(--c4)','var(--c5)'];
const valueColors=['var(--v1)','var(--v2)','var(--v3)','var(--v4)','var(--v5)'];
let nilaiData={};
const rubrikBody=document.getElementById("rubrik-body");
const posSelect=document.getElementById("pos");

function renderRubrik(pos){
  rubrikBody.innerHTML="";
  rubrik[pos].forEach((it,idx)=>{
    const card=document.createElement("div");
    card.className="aspek-card"; card.style.background=cardColors[idx%5];
    const left=document.createElement("div");left.className="left";
    left.innerHTML=`<div class="aspek-title">${it.aspek}</div><div class="indikator">${it.indikator}</div>`;
    const wrap=document.createElement("div");wrap.className="nilai-buttons";
    for(let n=1;n<=5;n++){
      let b=document.createElement("button");b.textContent=n;
      b.onclick=()=>setNilai(pos,idx,n,b,idx);
      if(nilaiData[pos]&&nilaiData[pos][idx]===n)b.classList.add("active");
      wrap.appendChild(b);
    }
    left.appendChild(wrap);
    const nilai=document.createElement("div");nilai.id=`nilai-${pos}-${idx}`;
    nilai.className="nilai-besar hidden";nilai.textContent="-";
    card.appendChild(left);card.appendChild(nilai);rubrikBody.appendChild(card);
  });
}
function setNilai(pos,idx,n,btn,idxForColor){
  if(!nilaiData[pos])nilaiData[pos]={};nilaiData[pos][idx]=n;
  btn.parentElement.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  const box=document.getElementById(`nilai-${pos}-${idx}`);
  box.textContent=n;box.classList.remove("hidden");
  box.style.color=valueColors[idxForColor%valueColors.length];
}
renderRubrik(1);posSelect.addEventListener("change",e=>renderRubrik(e.target.value));

/* ==== Submit ==== */
document.getElementById("submitBtn").addEventListener("click", () => {
  const nama = document.getElementById("nama").value.trim();
  const anggota = document.getElementById("anggota").value.trim();
  const pos = posSelect.value;

  if (!nama) {
    Swal.fire({
      icon: 'warning',
      title: 'Perhatian',
      text: 'Nama ketua wajib diisi',
      confirmButtonColor: '#facc15'
    });
    return;
  }

  if (!anggota) {
    Swal.fire({
      icon: 'warning',
      title: 'Perhatian',
      text: 'Kelompok wajib dipilih',
      confirmButtonColor: '#facc15'
    });
    return;
  }

  const aspekRubrik = rubrik[pos] || [];
  let adaKosong = aspekRubrik.some((a, idx) => !nilaiData[pos] || !nilaiData[pos][idx]);
  if (adaKosong) {
    Swal.fire({
      icon: 'warning',
      title: 'Perhatian',
      text: 'Semua skor rubrik wajib diisi',
      confirmButtonColor: '#facc15'
    });
    return;
  }

  const arr = aspekRubrik.map((a, idx) => ({
    aspek: a.aspek,
    nilai: nilaiData[pos][idx]
  }));

  // === Kirim ke Google Apps Script ===
  fetch(scriptURL, {
    method: "POST",
    body: new URLSearchParams({
      nama,
      unit: anggota,
      tipe: "kelompok", // pembeda penting untuk diarahkan ke sheet RekapKelompok
      nilai: JSON.stringify(arr)
    })
  })
    .then(async (r) => {
      let res = await r.text();
      console.log("Server response:", res);
      Swal.fire({
        icon: 'success',
        title: 'Berhasil!',
        text: 'Data kelompok tersimpan ke sheet RekapKelompok.',
        confirmButtonColor: '#16a34a',
        timer: 2000,
        showConfirmButton: false
      });

      // reset form setelah sukses
      document.getElementById("nama").value = "";
      document.getElementById("anggota").selectedIndex = 0;
      posSelect.value = "1";
      nilaiData = {};
      renderRubrik(1);
    })
    .catch((err) => {
      console.error("Fetch error:", err);
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'Gagal menyimpan data!',
        confirmButtonColor: '#dc2626'
      });
    });
});

/* ==== Reset ==== */
document.getElementById("resetBtn").addEventListener("click",()=>{
  nilaiData={};renderRubrik(posSelect.value);
  document.getElementById("nama").value="";
  document.getElementById("anggota").selectedIndex=0;
});

/* ==== Unduh Excel ==== */
document.getElementById("downloadExcel").addEventListener("click",()=>{
  const rows=[["Timestamp","Nama","Anggota","POS","Aspek","Nilai"]];
  const ts=new Date().toLocaleString();
  const nm=document.getElementById("nama").value;
  const ang=document.getElementById("anggota").value;
  for(const pos in nilaiData){
    (rubrik[pos]||[]).forEach((a,idx)=>{
      const skor=nilaiData[pos]&&nilaiData[pos][idx]?nilaiData[pos][idx]:"";
      rows.push([ts,nm,ang,"POS "+pos,a.aspek,skor]);
    });
  }
  const ws=XLSX.utils.aoa_to_sheet(rows);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Nilai");
  XLSX.writeFile(wb,"Nilai_Kelompok.xlsx");
});

</script>
<script>
document.getElementById("homeBtn").addEventListener("click", ()=>{
  const url = "window.top.location.href='https://andes-web.github.io/mpsmobile/";

  if(window.innerWidth <= 768){
    // ð¹ MOBILE â buka tab baru + coba tutup tab lama
    window.open(url, "_blank");
    window.open("", "_self");
    window.close();
  } else {
    // ð¹ DESKTOP â cukup buka tab baru (biarkan tab lama terbuka)
    window.open(url, "_blank");
  }
});
</script>
<!-- === Tambah hitungan pengunjung (tidak menampilkan angka) === -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const endpoint = "https://script.google.com/macros/s/AKfycbzrXSEevvL6nDIzmuXuP5aq7y_YUmYx7RKRugoZBGpfs6bbCTuLJ9luHhXIhBxmCBpo/exec";
  // Panggil tanpa parameter â otomatis menambah +1
  fetch(endpoint)
    .then(() => console.log("â Visitor count incremented"))
    .catch(err => console.warn("Visitor count error:", err));
});
</script>

</body>
</html>

