<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RUBRIK ASESMEN MANDIRI</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
:root{
  --bg: #fff5fc; --accent: #000000; --muted: #334e68; --card: #ffffff;
  --input: #f7f9fc; --nav-bg: #ffcefd; --shadow-light: rgba(0,0,0,0.05);
  --primary:#b30077; --deep-blue:#003366; --light-blue:#e9f2ff;
}
*{box-sizing:border-box; transition: all 0.2s ease-out;}
body{font-family:"Segoe UI",sans-serif;margin:0;background:var(--bg);color:var(--muted);font-size:13px}

header {
  position: fixed; top: 0; left: 0; right: 0; height: 44px;
  background: linear-gradient(90deg,#ff00b3,var(--primary));
  color: #fff; z-index: 1000; display: flex; align-items: center; justify-content: center;
}
header h1{margin:0;font-weight:700;font-size:15px;text-align:center}
.home-btn {
            position: absolute; left: 15px; color: white; text-decoration: none; 
            font-size: 18px; display: flex; align-items: center;
        }
.identity-bar {
  position: fixed; top: 44px; left: 0; right: 0;
  background: var(--nav-bg); padding: 6px 8px;
  z-index: 900; border-bottom: 1px solid #dcdfe4;
}
.identity-inner{ max-width:980px; margin:0 auto; display:flex; align-items:flex-start; justify-content:space-between; gap:8px; }
.identity-left{display:flex; flex-direction:column; gap:6px; flex:1 1 auto;}

.identity-toplabel-container{ background:var(--light-blue); border-radius:6px; padding:4px 8px; text-align:center; border:1px solid #c6d6f5; }
.identity-toplabel{font-weight:700; font-size:13px; color:var(--deep-blue);}

.identity-form-container{ background:#fff; border:1px solid #d3dae7; border-radius:8px; padding:6px 8px; }
.identity-row { display: grid; grid-template-columns: 3fr 80px; gap: 8px; margin-bottom: 6px; align-items: end; }
.identity-field { display: flex; flex-direction: column; gap: 2px; position: relative; }

label{font-weight:700; font-size:11px; color:var(--muted); white-space: nowrap;}

.custom-select-trigger {
  width: 100%; min-height: 32px; padding: 6px 8px; border-radius: 5px; border: 1px solid #c9d6e4;
  background: var(--input); font-size: 14px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
}

.input-token {
  width: 100%; height: 32px; padding: 6px 8px; border-radius: 5px; border: 1px solid #c9d6e4;
  background: #fff8e1; font-size: 16px; text-align: center; font-weight: bold;
}

.btn-mulai {
  width: 100%; background: var(--primary); color: #fff; border: none; border-radius: 6px; 
  padding: 10px; font-weight: 700; cursor: pointer; margin-top: 1px;
}

.floating-dropdown {
  position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #c9d6e4; 
  border-radius: 5px; margin-top: 2px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
  z-index: 1100; max-height: 200px; overflow-y: auto; display: none;
}
.floating-dropdown div { padding: 10px 12px; cursor: pointer; border-bottom: 1px solid #f1f1f1; font-size: 12px;}
.show { display: block; }

.score-panel{
  display:flex; flex-direction:column; align-items:center; gap:2px;
  padding:5px 6px; border-radius:6px; background:#fff; border:1px solid rgba(179,0,119,0.12); min-width:85px;
}
.score-pill{
  display:block; padding:2px 0; width:55px; text-align:center; border-radius:4px; 
  background:#fff5fc; border:1px solid rgba(179,0,119,0.08); font-weight:700; color:var(--primary); font-size:14px;
}
.score-label{font-size:10px; color:#444; font-weight:700; text-transform:uppercase;}

.main { max-width: 980px; margin: 0 auto; padding-top: 220px; padding-bottom: 80px; padding-left: 10px; padding-right: 10px; } 

#questions, #btnNext { display: none; }

.question-card {
  background: var(--card); border-left: 4px solid var(--accent); padding: 15px; border-radius: 8px; 
  margin-bottom: 15px; box-shadow: 0 4px 8px var(--shadow-light); word-wrap: break-word; overflow-wrap: break-word;
}

.q-text { font-size: 14px; margin: 0 0 12px 0; font-weight: 700; color: var(--accent); line-height: 1.5; white-space: normal; } 
.opt { 
  display: flex; align-items: flex-start; gap: 10px; padding: 12px; border-radius: 6px; 
  background: var(--input); border: 1px solid #e0e8f0; font-size: 13px; cursor: pointer; 
  margin-bottom: 8px; white-space: normal; line-height: 1.4; 
}
.opt input { margin-top: 3px; flex-shrink: 0; }
.opt span { flex: 1; word-break: break-word; overflow-wrap: break-word; }

.opt-correct { background: #e8f5e9 !important; border-color: #2e7d32 !important; color: #1b5e20 !important; font-weight: bold; }
.opt-wrong { background: #ffebee !important; border-color: #c62828 !important; color: #b71c1c !important; font-weight: bold; }
.question-card.locked { border-left: 5px solid var(--primary); background-color: #fcfcfc; pointer-events: none; }

.fixed-send{position:fixed; left:0; right:0; bottom:0; background:linear-gradient(90deg, #ff00d4, #b300a4); padding:10px; z-index:950;}
.btn-send{background:#fff; color:var(--accent); padding:10px 15px; border-radius:6px; border:none; font-weight:700; cursor:pointer;}

@media (max-width:480px){ .main{padding-top: 300px;} }
</style>
</head>
<body>

<header>
  <a href="https://andes-web.github.io/mpsmobile/" class="home-btn">
    <i class="fas fa-home"></i>
  </a>
  <h1>ASESMEN KARAKTER MANDIRI</h1>
</header>

<div class="identity-bar">
  <div class="identity-inner">
    <div class="identity-left">
      <div class="identity-toplabel-container"><div class="identity-toplabel">Lengkapi Identitas Keanggotaan</div></div>
      <div class="identity-form-container">
        <div class="identity-row">
          <div class="identity-field">
            <label>Unit</label>
            <div id="unit-trigger" class="custom-select-trigger">Pilih Unit</div>
            <div id="unit-dropdown" class="floating-dropdown"></div>
          </div>
          <div class="identity-field">
            <label>Token</label>
            <input type="text" id="input-token" class="input-token" placeholder="***">
          </div>
        </div>
        <div class="identity-row">
          <div class="identity-field">
            <label>Nama</label>
            <div id="nama-trigger" class="custom-select-trigger">Pilih Peserta</div>
            <div id="nama-dropdown" class="floating-dropdown"></div>
          </div>
          <div class="identity-field">
            <label>Panca Waluya</label>
            <div id="sesi-trigger" class="custom-select-trigger" style="justify-content:center">Cageur</div>
            <div id="sesi-dropdown" class="floating-dropdown">
              <div data-val="Cageur">Cageur</div><div data-val="Bageur">Bageur</div>
              <div data-val="Bener">Bener</div><div data-val="Pinter">Pinter</div>
              <div data-val="Singer">Singer</div>
            </div>
          </div>
        </div>
      </div>
      <button id="btnVerify" class="btn-mulai">MULAI ASESMEN</button>
    </div>
    <div class="score-panel">
      <div><div class="score-label">Cag</div><div class="score-pill" id="score-cag">0</div></div>
      <div><div class="score-label">Bag</div><div class="score-pill" id="score-bag">0</div></div>
      <div><div class="score-label">Ben</div><div class="score-pill" id="score-ben">0</div></div>
      <div><div class="score-label">Pin</div><div class="score-pill" id="score-pin">0</div></div>
      <div><div class="score-label">Sin</div><div class="score-pill" id="score-sin">0</div></div>
    </div>
  </div>
</div>

<main class="main"><div id="questions"></div></main>

<div class="fixed-send">
  <div style="max-width:980px; margin:0 auto; display:flex; justify-content:space-between; align-items:center;">
    <p style="color:#fff; margin:0">Â© 2025 Andes | MPS System</p>
    <button id="btnNext" class="btn-send">SIMPAN DATA</button>
  </div>
</div>

<script>
// GANTI DENGAN URL WEB APP ANDA
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzuZDCErpR_k3OaCwOpE24-hBQErV_PW__qEQMDvhtFqmUNRgaQQehSvaejgGiLf9I/exec";
let RAW_DATA = [], SEL_UNIT = "", SEL_SESI = "Cageur", SEL_NAMA = "", TOKEN_VALID = false, userAnswers = {};

const QUEST_DATA = {
    "Cageur": [
        { q: "Di tengah simulasi lapangan yang sangat menentukan, Anda mengalami nyeri dada tajam dan sesak napas, namun Anda sadar bahwa keluar barisan akan merusak penilaian formasi unit. Bagaimana Anda memandang kondisi ini?", o: ["Memaksakan seluruh sisa kekuatan demi menjaga kehormatan satuan meskipun tubuh sudah memberikan sinyal bahaya yang fatal", "Memutuskan untuk tetap di barisan dengan mengurangi gerakan secara sembunyi-sembunyi agar kelemahan fisik Anda tidak diketahui pelatih", "Mempengaruhi rekan di sekitar untuk ikut menurunkan tempo gerakan supaya beban fisik Anda terasa lebih ringan dibanding yang lain", "Memilih untuk melapor secara jujur kepada tim medis karena menyadari bahwa keselamatan nyawa jauh lebih utama daripada sekadar gengsi", "Mengkonsumsi obat penghilang rasa sakit milik rekan tanpa tahu dosisnya hanya agar bisa bertahan sampai sesi evaluasi berakhir"] },
        { q: "Pelatih memberikan teguran verbal yang sangat keras dan cenderung menyudutkan harga diri Anda di depan seluruh pasukan. Bagaimana mekanisme pertahanan mental Anda bekerja?", o: ["Merasa sangat terpukul secara emosional dan mulai merencanakan untuk segera meninggalkan organisasi karena merasa tidak dihargai lagi", "Menjaga stabilitas emosi dengan hanya menyerap instruksi teknis pelatih tanpa membiarkan amarahnya merusak kesehatan mental Anda sendiri", "Melakukan aksi protes secara verbal di lapangan untuk menunjukkan bahwa Anda memiliki harga diri yang tidak boleh diinjak-injak pelatih", "Membiarkan diri larut dalam kesedihan mendalam di tengah barisan hingga konsentrasi Anda pecah karena merasa sangat tertekan", "Menganggap remeh semua perkataan pelatih dan memilih bersikap masa bodoh karena merasa cara penyampaiannya tidak profesional"] },
        { q: "Malam sebelum hari penugasan besar, kecemasan yang luar biasa membuat Anda mengalami insomnia parah, padahal Anda butuh tenaga ekstra untuk besok pagi. Apa keputusan Anda?", o: ["Menghabiskan waktu dengan aktivitas hiburan di ponsel sampai fajar tiba karena menganggap tidur sebentar justru akan membuat pusing", "Mengambil jalan pintas dengan meminum obat tidur agar bisa terlelap instan tanpa memikirkan efek lemas yang mungkin muncul besok", "Melanggar aturan asrama untuk keluar mencari udara segar di luar lingkungan karena merasa sangat jenuh dengan tekanan ruangan", "Mendesak teman satu asrama untuk tetap bangun menemani Anda bercerita agar beban pikiran Anda bisa terbagi kepada orang lain", "Menerapkan teknik relaksasi mandiri di tempat tidur untuk memastikan tubuh tetap mendapatkan waktu pemulihan meskipun mata sulit terpejam"] },
        { q: "Saat sedang melakukan langkah tegap dalam upacara resmi, rekan tepat di depan Anda jatuh pingsan karena kelelahan. Sebagai orang di belakangnya, bagaimana respon Anda?", o: ["Serta-merta berhenti untuk memberikan pertolongan pertama secara emosional tanpa menunggu instruksi dari pimpinan barisan di lapangan", "Tetap menjaga disiplin posisi dan kekakuan langkah sesuai prosedur upacara sambil memberikan ruang bagi tim medis untuk bertindak", "Berhenti mendadak sambil berteriak meminta tolong kepada penonton di sekitar sehingga fokus seluruh pasukan menjadi terpecah", "Memberikan teguran keras kepada rekan tersebut setelah upacara selesai karena dianggap tidak becus menjaga kondisi fisik saat bertugas", "Pura-pura tidak melihat kejadian tersebut dan tetap fokus pada gerakan sendiri agar penilaian individu Anda tidak berkurang sedikit pun"] },
        { q: "Setelah berjam-jam latihan tanpa henti, Anda merasakan tanda-tanda dehidrasi dan kelaparan yang hebat, sementara instruktur belum memberikan tanda istirahat. Sikap Anda?", o: ["Mencari celah waktu untuk makan atau minum secara ilegal ketika instruktur sedang tidak memperhatikan area barisan Anda sendiri", "Melakukan manipulasi dengan menjatuhkan diri atau pura-pura pingsan agar bisa mendapatkan waktu istirahat lebih awal dari yang lain", "Memobilisasi ketahanan mental untuk tetap bertahan dalam fokus penuh sampai instruktur secara resmi membubarkan barisan latihan", "Menyuarakan keluhan dengan suara yang cukup keras agar didengar oleh instruktur dengan harapan durasi latihan segera dipersingkat", "Meninggalkan area latihan begitu saja tanpa pamit untuk mencari asupan nutrisi di kantin karena merasa fisik sudah mencapai batasnya"] }
    ],
    "Bageur": [
        { q: "Anda mendapati jatah makan siang rekan satu unit hilang atau tertukar, sementara Anda memiliki persediaan makanan tambahan yang cukup banyak. Apa langkah yang Anda ambil?", o: ["Mengkonsumsi seluruh persediaan makanan tersebut sendirian karena merasa itu adalah hak milik pribadi yang sah dan tidak wajib dibagi", "Memberikan persediaan makanan tambahan Anda kepada rekan tersebut secara tulus agar dia tetap memiliki energi untuk latihan selanjutnya", "Menjadikan kejadian hilangnya makanan tersebut sebagai bahan ejekan karena menganggap rekan Anda sangat ceroboh dalam menjaga barang", "Menghasut rekan tersebut untuk meminta-minta atau mengambil jatah milik anggota unit lain yang terlihat masih memiliki sisa makanan", "Melaporkan kejadian tersebut kepada pelatih dengan nada provokatif agar seluruh anggota dikenakan sanksi kolektif karena tidak disiplin"] },
        { q: "Seorang junior melakukan kesalahan gerakan yang sama secara berulang kali hingga memicu kemarahan pelatih dan hukuman bagi seluruh skuad. Bagaimana sikap Anda?", o: ["Memberikan sanksi psikologis berupa bentakan dan intimidasi kepada junior tersebut setelah jam latihan berakhir sebagai bentuk efek jera", "Mengintimidasi junior tersebut agar segera mengundurkan diri dari organisasi karena dianggap hanya akan merusak reputasi unit kedepannya", "Menerapkan hukuman sosial dengan melarang junior tersebut untuk berinteraksi atau makan bersama dengan anggota unit yang lainnya", "Mendekati junior tersebut secara personal untuk mengajarkan teknik gerakan yang benar dengan penuh kesabaran tanpa rasa menghakimi", "Meluapkan kekesalan dengan cara menyindir kegagalan junior tersebut melalui unggahan di media sosial agar diketahui oleh banyak orang"] },
        { q: "Saat waktu istirahat, Anda melihat banyak sampah berserakan di area yang bukan merupakan tanggung jawab unit Anda. Apa inisiatif yang muncul dalam diri Anda?", o: ["Segera mengambil dan membuang sampah tersebut ke tempatnya demi menjaga standar kebersihan dan kenyamanan lingkungan bersama", "Memilih untuk mengabaikan sampah tersebut karena merasa bukan Anda pelakunya dan bukan merupakan area tanggung jawab resmi unit Anda", "Memanggil petugas kebersihan atau adik kelas untuk membersihkan area tersebut karena merasa itu bukan level tugas seorang senior", "Mendokumentasikan tumpukan sampah tersebut untuk kemudian dikeluhkan di grup koordinasi tanpa melakukan tindakan pembersihan langsung", "Bersikap pasif dan baru akan bergerak melakukan pembersihan jika sudah ada instruksi tegas dari ketua unit atau pelatih lapangan"] },
        { q: "Rekan satu tim Anda terlihat sangat gemetar dan hilang fokus akibat demam panggung sesaat sebelum naik ke podium upacara. Bagaimana cara Anda berinteraksi?", o: ["Menambah kecemasannya dengan menceritakan potensi kegagalan dan risiko hukuman berat jika dia melakukan kesalahan di depan umum", "Memilih untuk tidak mempedulikannya agar perasaan gugup yang dialami rekan tersebut tidak menular dan merusak konsentrasi pribadi Anda", "Mendesak pelatih agar segera mengganti rekan tersebut dengan orang lain karena Anda meragukan kemampuannya untuk tampil maksimal", "Menertawakan kegugupan yang dia alami di hadapan teman-teman lainnya agar suasana yang tegang berubah menjadi bahan candaan", "Memberikan kata-kata penguatan serta dukungan moral yang menenangkan untuk membantu menstabilkan kondisi psikologis rekan tersebut"] },
        { q: "Unit dari sekolah lain mengalami kendala teknis saat membawa perlengkapan tenda mereka, padahal tugas unit Anda sudah selesai sepenuhnya. Apa tindakan Anda?", o: ["Memutuskan untuk segera beristirahat total karena menganggap tugas unit sendiri sudah tuntas dan tidak perlu memikirkan unit yang lain", "Hanya menonton kesulitan mereka dari jauh sambil memberikan komentar-komentar negatif mengenai kinerja unit sekolah lain tersebut", "Menawarkan bantuan tenaga secara sukarela untuk meringankan beban mereka sebagai bentuk solidaritas sesama anggota paskibra", "Memanfaatkan kesulitan mereka sebagai bahan konten ejekan di grup internal untuk menunjukkan bahwa unit Anda jauh lebih hebat", "Memilih untuk segera pergi atau berpura-pura tidur agar tidak perlu terlibat dalam upaya membantu kesulitan unit sekolah lainnya"] }
    ],
    "Bener": [
        { q: "Anda menemukan dompet milik pelatih tertinggal dalam keadaan terbuka di area yang sepi. Di dalamnya terdapat uang dalam jumlah banyak. Apa langkah Anda?", o: ["Mengambil sebagian kecil uang tersebut untuk keperluan operasional unit yang mendesak dengan niat akan menggantinya di kemudian hari", "Menyerahkan dompet tersebut kepada orang asing yang kebetulan lewat dengan harapan orang tersebut yang akan menyampaikannya", "Memutuskan untuk diam saja dan meninggalkan dompet tersebut di tempat semula agar Anda tidak dianggap sebagai pencuri jika ada masalah", "Mengecek seluruh isi dompet untuk mengetahui rahasia pribadi pelatih sebelum memutuskan untuk melaporkan penemuan tersebut", "Segera mengantarkan dompet tersebut langsung kepada pelatih tanpa menyentuh atau mengambil apa pun yang ada di dalamnya"] },
        { q: "Anda menyadari telah melakukan kesalahan kecil saat melakukan gerakan langkah tegap yang luput dari pengamatan juri. Bagaimana Anda bersikap saat evaluasi?", o: ["Mengklaim bahwa penampilan Anda sudah sangat sempurna tanpa cacat sedikit pun demi menjaga skor penilaian unit tetap tinggi", "Mengakui kesalahan tersebut secara jujur di hadapan pelatih sebagai bentuk tanggung jawab untuk perbaikan kualitas gerakan ke depan", "Membangun alasan bahwa sepatu yang kurang nyaman atau lapangan yang licin sebagai penyebab utama terjadinya kesalahan gerakan tersebut", "Menuding rekan di sebelah Anda sebagai penyebab utama yang memulai kesalahan sehingga gerakan Anda ikut terpengaruh di lapangan", "Melakukan manipulasi informasi dengan mengatakan bahwa juri sebenarnya salah dalam memberikan penilaian terhadap gerakan Anda tadi"] },
        { q: "Aturan karantina dengan tegas melarang membawa ponsel, namun Anda melihat hampir semua rekan melanggarnya secara sembunyi. Bagaimana prinsip Anda?", o: ["Ikut membawa ponsel demi rasa keadilan karena merasa tidak adil jika hanya Anda yang mematuhi aturan sementara yang lain melanggar", "Membawa ponsel namun sangat berhati-hati dalam menggunakannya agar tidak pernah terlihat oleh pelatih atau senior di asrama", "Memilih untuk meminjam ponsel milik teman yang melanggar agar Anda tetap bisa berkomunikasi tanpa harus menanggung risiko membawa sendiri", "Tetap memegang teguh komitmen untuk mematuhi aturan dengan tidak membawa ponsel sesuai dengan janji yang telah disepakati", "Melaporkan seluruh teman yang melanggar kepada otoritas tertinggi agar mereka semua mendapatkan hukuman yang sangat berat"] },
        { q: "Pelatih memberikan kepercayaan penuh pada Anda untuk memegang kunci gudang logistik. Rekan dekat Anda mengajak mengambil atribut tambahan secara ilegal. Respon Anda?", o: ["Menolak dengan sangat tegas sambil menjelaskan bahwa kunci tersebut adalah amanah yang berkaitan dengan integritas diri Anda", "Memberikan izin karena merasa stok atribut di gudang masih sangat melimpah dan tidak akan disadari oleh pelatih dalam waktu dekat", "Mengambilkan atribut tersebut untuk rekan Anda namun Anda sendiri tidak ikut mengambil agar merasa tidak sepenuhnya bersalah", "Membiarkan rekan tersebut masuk dan mengambil sendiri atribut yang dia inginkan agar Anda merasa tidak terlibat langsung dalam aksi itu", "Menjadikan permintaan rekan tersebut sebagai rahasia pribadi namun tetap menceritakannya kepada orang lain untuk merusak reputasinya"] },
        { q: "Waktu berkumpul yang ditetapkan adalah jam 05.00 pagi, namun Anda baru terbangun pada jam 04.55. Keputusan profesional apa yang akan Anda ambil?", o: ["Langsung berangkat ke lapangan apa adanya tanpa mandi atau bersiap maksimal hanya agar tidak dianggap terlambat oleh pelatih", "Memilih untuk datang terlambat dengan sengaja sambil menyusun berbagai alasan yang terdengar masuk akal agar tidak dimarahi", "Hadir secepat mungkin di lapangan latihan dan secara jantan siap menerima konsekuensi hukuman akibat kelalaian Anda sendiri", "Melakukan aksi tipu daya dengan pura-pura sakit agar Anda memiliki alasan yang sah untuk tidak hadir dalam sesi latihan pagi tersebut", "Mencoba menyelinap masuk ke dalam barisan dari arah belakang saat pelatih lengah agar keterlambatan Anda tidak diketahui siapa pun"] }
    ],
    "Pinter": [
        { q: "Terjadi perubahan rute defile secara mendadak oleh panitia saat pasukan sudah berada di lintasan. Sebagai pemimpin, bagaimana logika Anda bekerja?", o: ["Melakukan aksi protes keras di depan umum kepada panitia karena merasa jadwal latihan yang sudah matang menjadi sia-sia", "Mengalami kebingungan yang sangat parah hingga memutuskan untuk menghentikan seluruh pergerakan pasukan di tengah jalan raya", "Melakukan analisis cepat terhadap rute baru tersebut dan segera memberikan instruksi transisi gerakan yang efektif bagi pasukan", "Menginstruksikan seluruh pasukan untuk lari sekencang mungkin tanpa aturan baku agar cepat mencapai garis finish yang baru", "Berhenti bergerak dan hanya menunggu instruksi lanjutan dari pelatih yang posisinya sedang berada sangat jauh dari lokasi pasukan"] },
        { q: "Unit Anda tidak memiliki dukungan dana untuk menghadirkan pelatih ahli dari luar. Solusi strategis apa yang Anda ajukan dalam rapat?", o: ["Mengusulkan untuk membubarkan unit saja karena merasa tanpa pelatih ahli unit Anda tidak akan pernah bisa meraih prestasi apa pun", "Menuntut iuran dengan jumlah yang sangat memberatkan kepada seluruh anggota tanpa mempertimbangkan kondisi ekonomi masing-masing", "Melakukan tindakan pemaksaan kepada pihak sekolah untuk mencairkan dana darurat meskipun prosedur administrasinya melanggar aturan", "Memutuskan untuk hanya melakukan latihan fisik dasar saja tanpa ada upaya untuk mempelajari materi atau inovasi gerakan baru", "Menginisiasi gerakan belajar mandiri dengan membedah video kompetisi serta melakukan diskusi teknis bersama seluruh anggota unit"] },
        { q: "Saat sedang memaparkan materi sejarah paskibra, seorang audiens memberikan pertanyaan teknis yang sangat sulit. Bagaimana jawaban intelektual Anda?", o: ["Mengarang jawaban secara spontan agar Anda tetap terlihat memiliki pengetahuan yang luas di mata audiens dan anggota lainnya", "Memberikan jawaban berdasarkan data yang diketahui saat itu dan berkomitmen jujur untuk melakukan riset lebih lanjut nantinya", "Menunjukkan sikap marah karena menganggap pertanyaan tersebut hanya bertujuan untuk mempermalukan atau menjatuhkan kredibilitas Anda", "Mendelegasikan tugas menjawab kepada rekan lain secara paksa karena Anda merasa tidak sanggup memberikan penjelasan yang tepat", "Hanya diam membisu dan segera mengalihkan pembicaraan ke topik lain yang lebih mudah untuk Anda kuasai tanpa menjawab pertanyaan"] },
        { q: "Sepatu boot milik salah satu personil utama mengalami kerusakan parah tepat 10 menit sebelum waktu tampil dimulai. Apa langkah mitigasi Anda?", o: ["Menangis dan merasa putus asa karena menganggap penampilan unit pasti akan hancur dan menjadi bahan tertawaan juri", "Mengambil keputusan sepihak untuk melarang anggota tersebut ikut tampil tanpa memikirkan keseimbangan formasi pasukan", "Menyalahkan anggota tersebut habis-habisan karena dianggap tidak profesional dalam mengecek kesiapan peralatan pribadinya", "Melakukan improvisasi cepat dengan menggunakan alat perekat atau mencari pinjaman sepatu yang ukurannya mendekati personil tersebut", "Mencoba mencari toko sepatu terdekat meskipun secara logika waktu yang tersisa tidak akan mungkin cukup untuk kembali tepat waktu"] },
        { q: "Anda diwajibkan untuk menguasai puluhan variasi formasi yang sangat kompleks dalam waktu semalam. Metode belajar apa yang Anda terapkan?", o: ["Mempelajari pola logika perpindahan setiap personil dan memahami filosofi gerakan agar lebih mudah diingat secara permanen", "Melakukan hafalan mekanis secara terus-menerus tanpa jeda istirahat sedikit pun hingga otak Anda merasa sangat jenuh dan lelah", "Memutuskan untuk menyerah dan hanya berencana mengikuti gerakan teman di depan Anda saat berada di lapangan esok hari", "Mengkonsumsi stimulan atau kopi secara berlebihan agar mata tetap terjaga meskipun konsentrasi otak sudah mulai menurun drastis", "Menghubungi instruktur untuk memohon agar jumlah variasi formasi dikurangi karena alasan waktu persiapan yang terlalu singkat"] }
    ],
    "Singer": [
        { q: "Anda menyadari tali bendera terlihat melilit saat prosesi pengibaran sedang berlangsung. Anda berada di posisi terdekat. Bagaimana respon sigap Anda?", o: ["Hanya diam memperhatikan kejadian tersebut sambil berharap dalam hati agar lilitan tali tersebut tidak membuat bendera macet", "Secara tenang, terukur, dan sigap mengambil inisiatif untuk membantu membenarkan posisi tali tanpa merusak kekhidmatan upacara", "Berteriak dengan suara keras untuk memperingatkan petugas pengibar bahwa kondisi tali sedang tidak aman sehingga mengganggu suasana", "Menertawakan kegagalan petugas pengibar jika nantinya bendera benar-benar berhenti di tengah tiang karena kesalahan teknis tersebut", "Memilih untuk merekam kejadian tersebut menggunakan ponsel secara diam-diam demi konten yang menarik di media sosial unit"] },
        { q: "Gudang perlengkapan dalam kondisi sangat kacau dan kotor setelah sebuah acara besar selesai. Apa tindakan nyata yang Anda lakukan?", o: ["Tanpa perlu menunggu perintah siapa pun, Anda segera mulai mengorganisir dan merapikan seluruh perlengkapan dengan cepat", "Langsung meninggalkan lokasi gudang karena merasa sudah sangat lelah dan ingin segera beristirahat di kenyamanan rumah Anda", "Hanya memilih untuk merapikan barang-barang yang menjadi milik pribadi Anda saja dan mengabaikan kekacauan barang-barang unit", "Melakukan aksi saling tuduh dan menyalahkan orang lain yang dianggap menjadi penyebab utama gudang menjadi sangat berantakan", "Hanya berdiri diam dan baru akan bekerja jika sudah ada instruksi spesifik dari koordinator logistik atau senior yang bertugas"] },
        { q: "Instruktur sedang berhalangan hadir karena urusan administrasi, sementara pasukan sudah siap di lapangan. Sebagai senior, apa langkah Anda?", o: ["Ikut bergabung dengan anggota lain untuk bersantai dan bercanda sambil menunggu instruktur selesai dengan urusan kantornya", "Memberikan izin kepada seluruh pasukan untuk bermain ponsel masing-masing di lapangan selama instruktur belum menampakkan diri", "Meninggalkan lapangan latihan untuk mencari keberadaan instruktur di ruangannya demi mendapatkan kepastian kapan latihan dimulai", "Mengambil alih pimpinan barisan secara inisiatif dan memulai sesi pemanasan agar disiplin waktu tetap terjaga di lapangan", "Memutuskan untuk tidur di area yang teduh hingga instruktur benar-benar datang dan membangunkan seluruh anggota pasukan"] },
        { q: "Salah satu atribut krusial pada seragam rekan Anda terlepas saat sudah berada di area utama yang sangat formal. Apa respon terampil Anda?", o: ["Hanya sekadar memberi tahu rekan tersebut bahwa seragamnya rusak sehingga dia menjadi sangat panik di hadapan banyak orang", "Menjadikan hal tersebut sebagai bahan tertawaan karena menganggap rekan Anda sangat ceroboh dalam mempersiapkan seragamnya", "Segera membantunya melakukan perbaikan darurat dengan alat yang Anda bawa agar penampilan rekan tersebut kembali sempurna", "Menyuruhnya secara paksa untuk bertukar seragam dengan anggota lain yang ukurannya lebih pas meskipun waktunya sudah mepet", "Mengatakan kepada rekan tersebut bahwa masalah kancing baju adalah urusan pribadi masing-masing dan bukan tanggung jawab Anda"] },
        { q: "Hujan deras turun tiba-tiba saat kegiatan berkemah dan air mulai merembes masuk ke dalam tenda. Apa langkah antisipasi yang Anda ambil?", o: ["Menunjukkan reaksi panik dengan menangis di dalam tenda dan meminta untuk segera dipulangkan saat itu juga karena takut", "Membiarkan kondisi tersebut terjadi karena merasa tenda yang digunakan bukan milik pribadi sehingga kerusakannya bukan urusan Anda", "Menyalahkan pihak panitia penyelenggara karena dianggap tidak becus dalam memilih lokasi perkemahan yang aman dari banjir", "Berusaha menyelinap masuk ke dalam tenda milik unit lain yang lebih aman tanpa meminta izin terlebih dahulu kepada pemiliknya", "Secara sigap melakukan rekayasa saluran air di sekitar tenda dan segera mengamankan seluruh aset logistik agar tetap kering"] }
    ]
};

const CORRECT_ANSWERS = {
    "Cageur": ["4", "2", "5", "2", "3"], "Bageur": ["2", "4", "1", "5", "3"],
    "Bener":  ["5", "2", "4", "1", "3"], "Pinter": ["3", "5", "2", "4", "1"],
    "Singer": ["2", "1", "4", "3", "5"]
};
  
// 1. FUNGSI MULAI (DENGAN CEK DATABASE)
document.getElementById('btnVerify').onclick = async () => {
    const token = document.getElementById('input-token').value.trim();
    if (!SEL_NAMA || !token) { Swal.fire("Peringatan", "Pilih Nama dan isi Token!", "warning"); return; }
    
    Swal.fire({ title: 'Verifikasi Akses...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });

    try {
        const resp = await fetch(`${SCRIPT_URL}?action=verifyToken&nama=${encodeURIComponent(SEL_NAMA)}&token=${encodeURIComponent(token)}`);
        const res = await resp.json();

        if (res.alreadySubmitted) {
            Swal.fire({
                title: "Anda Sudah Mengisi!",
                html: `<div style="text-align:left; background:#f0f4f8; padding:15px; border-radius:10px; border:1px solid #c3dafe;">
                        <p style="text-align:center; margin-bottom:10px;">Data <b>${SEL_NAMA}</b> sudah ada di MPS sistem.</p>
                        <hr>
                        <p style="font-weight:bold; color:var(--primary); text-align:center; font-size:16px;">HASIL ANDA:</p>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                          <span>Cageur: <b>${res.data.cag}</b></span>
                          <span>Bageur: <b>${res.data.bag}</b></span>
                          <span>Bener : <b>${res.data.ben}</b></span>
                          <span>Pinter: <b>${res.data.pin}</b></span>
                          <span>Singer: <b>${res.data.sin}</b></span>
                        </div>
                        <h2 style="color:#b30077; text-align:center; font-weight:900; font-size:32px; margin-top:15px;">${res.data.avg}</h2>
                       </div>`,
                icon: "error"
            });
        } else if (res.valid) {
            TOKEN_VALID = true;
            document.getElementById('questions').style.display = "block";
            document.getElementById('btnNext').style.display = "block";
            document.getElementById('btnVerify').style.display = "none";
            renderQuestions(SEL_SESI);
            Swal.fire("Berhasil", "Token Valid. Silahkan kerjakan.", "success");
        } else {
            Swal.fire("Gagal", "Token Salah!", "error");
        }
    } catch (e) { Swal.fire("Error", "Gagal cek database.", "error"); }
};

// 2. FUNGSI RENDER SOAL (DENGAN WRAPPING)
function renderQuestions(sesi) {
    const container = document.getElementById('questions');
    container.innerHTML = `<h2 style="text-align:center; color:var(--primary); margin-bottom:20px;">Rubrik: ${sesi}</h2>`;
    QUEST_DATA[sesi].forEach((item, i) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        const saved = userAnswers[`${sesi}_${i}`];
        if(saved) card.classList.add('locked');
        card.innerHTML = `<div class="q-text">${i+1}. ${item.q}</div>`;
        item.o.forEach((txt, idx) => {
            const val = (idx + 1).toString();
            const l = document.createElement('label');
            l.className = 'opt';
            if(saved === val) l.classList.add(val === CORRECT_ANSWERS[sesi][i] ? 'opt-correct' : 'opt-wrong');
            l.innerHTML = `<input type="radio" name="q${i}" value="${val}" ${saved === val ? 'checked':''} disabled> <span>${txt}</span>`;
            l.onclick = () => {
                if(card.classList.contains('locked')) return;
                userAnswers[`${sesi}_${i}`] = val;
                if(val === CORRECT_ANSWERS[sesi][i]) l.classList.add('opt-correct');
                else l.classList.add('opt-wrong');
                card.classList.add('locked');
                calculateScore();
            };
            card.appendChild(l);
        });
        container.appendChild(card);
    });
}

function calculateScore() {
    const sesis = ["Cageur", "Bageur", "Bener", "Pinter", "Singer"];
    const ids = ["score-cag", "score-bag", "score-ben", "score-pin", "score-sin"];
    sesis.forEach((s, idx) => {
        let score = 0;
        for(let i=0; i<5; i++) {
            const ans = userAnswers[`${s}_${i}`];
            if(ans === CORRECT_ANSWERS[s][i]) score += 20;
            else if(ans) score += 10;
        }
        document.getElementById(ids[idx]).textContent = score;
    });
}

// 3. FUNGSI SIMPAN & TAMPIL NILAI
document.getElementById('btnNext').onclick = async () => {
    if(Object.keys(userAnswers).length < 25) { Swal.fire("Peringatan", "Selesaikan semua soal!", "warning"); return; }
    
    const confirm = await Swal.fire({
        title: 'Kirim Jawaban?',
        text: "Pastikan data sudah benar. Anda tidak bisa mengulang!",
        icon: 'question', showCancelButton: true, confirmButtonText: 'Ya, Kirim!'
    });

    if(!confirm.isConfirmed) return;

    Swal.fire({ title: 'Menyimpan...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });

    const sCag = document.getElementById('score-cag').textContent;
    const sBag = document.getElementById('score-bag').textContent;
    const sBen = document.getElementById('score-ben').textContent;
    const sPin = document.getElementById('score-pin').textContent;
    const sSin = document.getElementById('score-sin').textContent;
    const avg = Math.round((parseInt(sCag)+parseInt(sBag)+parseInt(sBen)+parseInt(sPin)+parseInt(sSin))/5);

    const payload = {
        nama: SEL_NAMA, unit: SEL_UNIT, sesi: "LENGKAP", 
        token: document.getElementById('input-token').value.trim(),
        skor_cag: sCag, skor_bag: sBag, skor_ben: sBen, skor_pin: sPin, skor_sin: sSin,
        rata_rata: avg, jawaban: userAnswers
    };

    try {
        const resp = await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(payload) });
        const res = await resp.json();
        if(res.status === "success") {
            await Swal.fire({
                title: "Berhasil!",
                html: `<div style="text-align:center;">
                        <h2 style="color:var(--primary);">NILAI: ${avg}</h2>
                        <p>Data <b>${SEL_NAMA}</b> telah aman tersimpan.</p>
                       </div>`,
                icon: "success"
            });
            location.reload();
        }
    } catch(e) { Swal.fire("Error", "Gagal kirim data.", "error"); }
};

// 4. DROPDOWN LOGIC
function setupDropdown(triggerId, dropdownId, onSelect) {
    const trigger = document.getElementById(triggerId);
    const dropdown = document.getElementById(dropdownId);
    trigger.onclick = (e) => { e.stopPropagation(); dropdown.classList.toggle('show'); };
    dropdown.onclick = (e) => {
        if(e.target.tagName === 'DIV') {
            const val = e.target.getAttribute('data-val') || e.target.textContent;
            trigger.textContent = val;
            dropdown.classList.remove('show');
            onSelect(val, e.target.getAttribute('data-idx'));
        }
    };
}
window.onclick = () => document.querySelectorAll('.floating-dropdown').forEach(d => d.classList.remove('show'));

setupDropdown('unit-trigger', 'unit-dropdown', (val, idx) => {
    SEL_UNIT = val; SEL_NAMA = "";
    document.getElementById('nama-trigger').textContent = "Pilih Nama";
    const namaDrop = document.getElementById('nama-dropdown');
    namaDrop.innerHTML = "";
    for(let r=1; r<RAW_DATA.length; r++) { if(RAW_DATA[r][idx]) namaDrop.innerHTML += `<div>${RAW_DATA[r][idx]}</div>`; }
});

setupDropdown('nama-trigger', 'nama-dropdown', (val) => { 
    SEL_NAMA = val; TOKEN_VALID = false;
    document.getElementById('questions').style.display = "none";
    document.getElementById('btnNext').style.display = "none";
    document.getElementById('btnVerify').style.display = "block";
});

setupDropdown('sesi-trigger', 'sesi-dropdown', (val) => { 
    SEL_SESI = val; if(TOKEN_VALID) renderQuestions(val); 
});

async function loadData() {
    try {
        const res = await fetch(`${SCRIPT_URL}?action=peserta`);
        RAW_DATA = await res.json();
        const unitDrop = document.getElementById('unit-dropdown');
        RAW_DATA[0].forEach((u, i) => { if(u) unitDrop.innerHTML += `<div data-idx="${i}">${u}</div>`; });
    } catch(e) {}
}
loadData();
</script>
</body>
</html>
