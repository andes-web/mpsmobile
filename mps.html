<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Form Penilaian BINTAL - Modern & Compact</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap');
    
    :root {
      --primary-color: #00d4ff;
      --secondary-color: #ff00ff;
      --accent-color: #00ff88;
      --dark-bg: #0a0e27;
      --card-bg: #1a1f3a;
      --border-glow: #00d4ff;
      --inactive-color: #4a5568;
      --text-light: #e2e8f0;
      --shadow-color: rgba(0, 212, 255, 0.4);
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      padding-top: 190px;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1429 100%);
      font-family: 'Rajdhani', sans-serif;
      color: var(--text-light);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        repeating-linear-gradient(0deg, rgba(0, 212, 255, 0.03) 0px, transparent 1px, transparent 2px, rgba(0, 212, 255, 0.03) 3px),
        repeating-linear-gradient(90deg, rgba(0, 212, 255, 0.03) 0px, transparent 1px, transparent 2px, rgba(0, 212, 255, 0.03) 3px);
      pointer-events: none;
      z-index: 1;
    }
    
    .container, .container-fluid {
      position: relative;
      z-index: 2;
    }
    
    .main-title-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(10, 14, 39, 0.98) 0%, rgba(26, 31, 58, 0.95) 100%);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid var(--border-glow);
      box-shadow: 0 0 30px var(--shadow-color), 0 4px 20px rgba(0, 0, 0, 0.5);
      z-index: 1040;
      padding: 8px 0;
      animation: slideDown 0.5s ease-out;
    }
    
    @keyframes slideDown {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .main-title-header h6 {
      margin: 0 !important;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.75rem;
      font-weight: 400;
      color: var(--accent-color);
      text-transform: uppercase;
      letter-spacing: 3px;
      text-shadow: 0 0 10px var(--accent-color);
    }
    
    .main-title-header h5 {
      margin: 4px 0 0 0 !important;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      font-weight: 900;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 20px var(--primary-color);
      letter-spacing: 2px;
    }
    
    .sticky-assessment-header {
      top: 52px;
      position: fixed;
      left: 0;
      right: 0;
      z-index: 1020;
      background: linear-gradient(180deg, rgba(26, 31, 58, 0.95) 0%, rgba(10, 14, 39, 0.98) 100%);
      backdrop-filter: blur(15px);
      box-shadow: 0 0 40px rgba(0, 212, 255, 0.3), 0 8px 30px rgba(0, 0, 0, 0.6);
      border-bottom: 1px solid var(--border-glow);
    }
    
    .identity-container {
      padding: 10px 15px;
      border-bottom: 1px solid rgba(0, 212, 255, 0.3);
      background: rgba(26, 31, 58, 0.5);
    }
    
    .identity-container h5 {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary-color);
      font-size: 0.9rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 10px !important;
      text-shadow: 0 0 10px var(--primary-color);
    }
    
    .tab-header-row {
      margin: 0;
      border-bottom: 2px solid var(--border-glow);
      background: rgba(10, 14, 39, 0.8);
    }
    
    .header-tab {
      cursor: pointer;
      padding: 12px;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
      color: var(--inactive-color);
      background: transparent;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .header-tab::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }
    
    .header-tab:hover::before {
      left: 100%;
    }
    
    .header-tab:hover {
      color: var(--primary-color);
      background: rgba(0, 212, 255, 0.1);
    }
    
    .header-tab.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
      background: linear-gradient(180deg, rgba(0, 212, 255, 0.2), rgba(0, 212, 255, 0.05));
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
      text-shadow: 0 0 10px var(--primary-color);
    }
    
    .tab-name-text {
      flex-grow: 1;
      text-align: left;
      padding-right: 10px;
    }
    
    .tab-total-score {
      flex-shrink: 0;
      min-width: 35px;
      font-size: 1.8rem;
      font-weight: 900;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: right;
      line-height: 1;
      text-shadow: 0 0 20px var(--primary-color);
      filter: drop-shadow(0 0 10px var(--primary-color));
    }
    
    .accordion-row {
      padding: 0;
      background: rgba(10, 14, 39, 0.6);
      margin: 0;
      display: flex;
      gap: 2px;
      border-bottom: 1px solid rgba(0, 212, 255, 0.3);
    }
    
    .accordion-row > .col {
      padding: 0 !important;
      flex-shrink: 0;
      width: 20%;
      max-width: 20%;
    }
    
    .accordion-button {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.65rem;
      padding: 10px 8px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
      display: flex !important;
      justify-content: center !important;
      align-items: center;
      text-align: center !important;
      background: linear-gradient(135deg, #1a1f3a, #0f1429) !important;
      color: var(--inactive-color) !important;
      border: 1px solid rgba(74, 85, 104, 0.5);
      border-radius: 0 !important;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .accordion-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.3), transparent);
      transition: left 0.4s ease;
    }
    
    .accordion-button:hover::before {
      left: 100%;
    }
    
    .accordion-button:hover {
      color: var(--primary-color) !important;
      border-color: var(--primary-color);
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
    }
    
    .accordion-button:not(.collapsed) {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.3), rgba(0, 255, 136, 0.2)) !important;
      color: var(--primary-color) !important;
      border: 2px solid var(--primary-color) !important;
      box-shadow: 
        0 0 20px rgba(0, 212, 255, 0.5),
        inset 0 0 20px rgba(0, 212, 255, 0.1);
      text-shadow: 0 0 10px var(--primary-color);
      transform: translateY(-2px);
    }
    
    .accordion-content-area {
      margin-top: 30px;
      background: linear-gradient(135deg, rgba(26, 31, 58, 0.9), rgba(15, 20, 41, 0.9));
      border: 2px solid var(--border-glow);
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: 
        0 0 30px rgba(0, 212, 255, 0.3),
        0 10px 40px rgba(0, 0, 0, 0.5),
        inset 0 0 50px rgba(0, 212, 255, 0.05);
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    
    .accordion-content-area::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0, 212, 255, 0.1) 0%, transparent 70%);
      animation: rotate 20s linear infinite;
      pointer-events: none;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .identity-custom-dropdown {
      position: relative;
      width: 100%;
    }
    
    .identity-display-btn {
      cursor: pointer;
      padding: 8px 40px 8px 15px;
      position: relative;
      border: 2px solid rgba(0, 212, 255, 0.5);
      border-radius: 10px;
      background: linear-gradient(135deg, rgba(26, 31, 58, 0.8), rgba(15, 20, 41, 0.8));
      width: 100%;
      font-size: 0.9rem;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 500;
      color: var(--text-light);
      text-align: left;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
    }
    
    .identity-display-btn:hover {
      border-color: var(--primary-color);
      box-shadow: 0 0 25px rgba(0, 212, 255, 0.4);
      transform: translateY(-2px);
    }
    
    .identity-display-btn::after {
      content: "â–¼";
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.7rem;
      color: var(--primary-color);
      text-shadow: 0 0 5px var(--primary-color);
    }
    
    .identity-options-list {
      position: absolute;
      top: calc(100% + 5px);
      left: 0;
      width: 100%;
      max-height: 300px;
      overflow-y: auto;
      z-index: 1055;
      background: linear-gradient(135deg, rgba(26, 31, 58, 0.98), rgba(15, 20, 41, 0.98));
      border: 2px solid var(--border-glow);
      border-radius: 10px;
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.4), 0 10px 40px rgba(0, 0, 0, 0.6);
      display: none;
      backdrop-filter: blur(10px);
    }
    
    .identity-options-list::-webkit-scrollbar {
      width: 8px;
    }
    
    .identity-options-list::-webkit-scrollbar-track {
      background: rgba(26, 31, 58, 0.5);
      border-radius: 4px;
    }
    
    .identity-options-list::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
      box-shadow: 0 0 10px var(--primary-color);
    }
    
    .identity-option {
      padding: 10px 15px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }
    
    .identity-option:hover {
      background: rgba(0, 212, 255, 0.2);
      border-left-color: var(--primary-color);
      padding-left: 20px;
    }
    
    .identity-option.active {
      background: linear-gradient(90deg, rgba(0, 212, 255, 0.3), transparent);
      color: var(--primary-color);
      border-left-color: var(--primary-color);
      font-weight: 700;
      text-shadow: 0 0 10px var(--primary-color);
    }
    
    .input-group-text {
      width: 85%;
      font-size: 0.9rem;
      font-weight: 500;
      border: none;
      background: transparent !important;
      padding: 8px 10px;
      color: var(--text-light);
    }
    
    .penilaian-row {
      padding: 8px 0;
      border-bottom: 1px solid rgba(0, 212, 255, 0.2);
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .penilaian-row::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 3px;
      height: 0;
      background: var(--primary-color);
      transition: height 0.3s ease;
      box-shadow: 0 0 10px var(--primary-color);
    }
    
    .penilaian-row:hover {
      background: rgba(0, 212, 255, 0.05);
      padding-left: 10px;
    }
    
    .penilaian-row:hover::before {
      height: 100%;
    }
    
    .score-custom-dropdown {
      position: relative;
      width: 15%;
      flex-shrink: 0;
    }
    
    .score-display-btn {
      width: 100%;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.85rem;
      font-weight: 700;
      padding: 6px 8px;
      height: 32px;
      text-align: center;
      border: 2px solid rgba(0, 212, 255, 0.5);
      background: linear-gradient(135deg, rgba(26, 31, 58, 0.8), rgba(15, 20, 41, 0.8));
      border-radius: 8px;
      color: var(--text-light);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
    }
    
    .score-display-btn:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 0 25px rgba(0, 212, 255, 0.4);
    }
    
    .score-display-btn::after {
      content: "â–¼";
      position: absolute;
      right: 4px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.5rem;
      color: var(--primary-color);
    }
    
    .score-options-list {
      position: absolute;
      top: calc(100% + 5px);
      right: 0;
      width: 100%;
      z-index: 1050;
      background: linear-gradient(135deg, rgba(26, 31, 58, 0.98), rgba(15, 20, 41, 0.98));
      border: 2px solid var(--border-glow);
      border-radius: 8px;
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
      display: none;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }
    
    .score-options-list .score-option {
      padding: 8px;
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      text-align: center;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }
    
    .score-option:hover {
      background: rgba(0, 212, 255, 0.2);
      border-left-color: var(--primary-color);
      transform: translateX(5px);
    }
    
    .score-display-btn.score-1 {
      background: linear-gradient(135deg, #ff6b35, #f7931e) !important;
      border-color: #ff6b35 !important;
      color: #fff !important;
      box-shadow: 0 0 20px rgba(255, 107, 53, 0.6);
    }
    
    .score-display-btn.score-2 {
      background: linear-gradient(135deg, #4834d4, #686de0) !important;
      border-color: #4834d4 !important;
      color: #fff !important;
      box-shadow: 0 0 20px rgba(72, 52, 212, 0.6);
    }
    
    .score-display-btn.score-3 {
      background: linear-gradient(135deg, #00d2ff, #3a7bd5) !important;
      border-color: #00d2ff !important;
      color: #fff !important;
      box-shadow: 0 0 20px rgba(0, 210, 255, 0.6);
    }
    
    .score-display-btn.score-4 {
      background: linear-gradient(135deg, #11998e, #38ef7d) !important;
      border-color: #11998e !important;
      color: #fff !important;
      box-shadow: 0 0 20px rgba(17, 153, 142, 0.6);
    }
    
    .score-display-btn.score-5 {
      background: linear-gradient(135deg, #eb3349, #f45c43) !important;
      border-color: #eb3349 !important;
      color: #fff !important;
      box-shadow: 0 0 20px rgba(235, 51, 73, 0.6);
    }
    
    .section-title-box {
      text-align: center !important;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700 !important;
      font-size: 1.1rem;
      padding: 12px;
      margin: 20px 0 15px 0 !important;
      border: 2px solid var(--border-glow);
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 255, 136, 0.1));
      border-radius: 10px;
      color: var(--primary-color) !important;
      text-transform: uppercase;
      letter-spacing: 2px;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .section-title-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: shimmer 3s infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { left: -100%; }
      50% { left: 100%; }
    }
    
    .sticky-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(26, 31, 58, 0.95), rgba(10, 14, 39, 0.98));
      backdrop-filter: blur(15px);
      padding: 12px 0;
      border-top: 2px solid var(--border-glow);
      box-shadow: 0 0 40px rgba(0, 212, 255, 0.3), 0 -8px 30px rgba(0, 0, 0, 0.6);
      z-index: 1030;
    }
    
    .btn {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 10px 20px;
      border-radius: 8px;
      transition: all 0.3s ease;
      border: 2px solid;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .btn-outline-secondary {
      color: var(--text-light);
      border-color: var(--inactive-color);
      background: transparent;
    }
    
    .btn-outline-secondary:hover {
      color: var(--primary-color);
      border-color: var(--primary-color);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
      transform: translateY(-3px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      border-color: var(--primary-color);
      color: #0a0e27;
      font-weight: 900;
      box-shadow: 0 0 25px rgba(0, 212, 255, 0.5);
    }
    
    .btn-primary:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 0 35px rgba(0, 212, 255, 0.7);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, rgba(74, 85, 104, 0.5), rgba(45, 55, 72, 0.5));
      border-color: var(--inactive-color);
      color: var(--inactive-color);
    }
    
    .btn-secondary.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .toast {
      background: linear-gradient(135deg, rgba(26, 31, 58, 0.98), rgba(15, 20, 41, 0.98));
      border: 2px solid var(--border-glow);
      border-radius: 10px;
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
      backdrop-filter: blur(10px);
    }
    
    .toast-header {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      background: transparent;
      border-bottom: 1px solid rgba(0, 212, 255, 0.3);
      color: var(--text-light);
    }
    
    .toast-header.text-bg-success {
      color: var(--accent-color) !important;
      text-shadow: 0 0 10px var(--accent-color);
    }
    
    .toast-header.text-bg-danger {
      color: #ff4757 !important;
      text-shadow: 0 0 10px #ff4757;
    }
    
    .toast-body {
      color: var(--text-light);
      font-weight: 500;
    }
    
    @media (max-width: 768px) {
      .main-title-header h5 {
        font-size: 1.1rem;
      }
      
      .tab-total-score {
        font-size: 1.5rem;
      }
      
      .accordion-button {
        font-size: 0.6rem;
        padding: 8px 4px;
      }
    }
  </style>
</head>
<body>

<header class="main-title-header">
  <div class="container-fluid text-center">
    <h6 class="text-primary">PENILAIAN NON TEKNIS</h6>
    <h5 class="text-dark">BIMBINGAN MENTAL</h5>
  </div>
</header>

<div class="sticky-assessment-header">
    <div class="container-fluid">
        <div class="row g-1 identity-container">
            <h5 class="mb-2 text-secondary d-none d-md-block">ðŸ‘¥ Data Yang Dinilai</h5>
            
            <div class="col-6">
                <div class="identity-custom-dropdown" id="unit-dropdown" data-target-id="unit-select">
                    <button class="identity-display-btn form-select-sm text-start" type="button" data-value="">Unit...</button>
                    <div class="identity-options-list" id="unit-options-list"></div>
                    <input type="hidden" id="unit-select" name="Unit" value="">
                </div>
            </div>
            
            <div class="col-6">
                <div class="identity-custom-dropdown" id="kelompok-dropdown" data-target-id="kelompok-select">
                    <button class="identity-display-btn form-select-sm text-start" type="button" data-value="">Kelompok...</button>
                    <div class="identity-options-list" id="kelompok-options-list"></div>
                    <input type="hidden" id="kelompok-select" name="Kelompok" value="">
                </div>
            </div>
            
            <div class="col-12 mt-2">
                <div class="identity-custom-dropdown" id="nama-dropdown" data-target-id="nama-select">
                    <button class="identity-display-btn form-select-sm text-start" type="button" data-value="">Pilih Nama...</button>
                    <div class="identity-options-list" id="nama-options-list"></div>
                    <input type="hidden" id="nama-select" name="Nama" value="">
                </div>
            </div>
        </div>

        <div class="row tab-header-row">
            <div class="col-6 header-tab active" id="tab-peserta" onclick="switchTab('peserta')">
                <span class="tab-name-text">PESERTA</span>
                <span class="tab-total-score" id="total-score-peserta">0</span>
            </div>
            <div class="col-6 header-tab" id="tab-panitia" onclick="switchTab('panitia')">
                <span class="tab-name-text">PANITIA</span>
                <span class="tab-total-score" id="total-score-panitia">0</span>
            </div>
        </div>

        <div id="sticky-category-content">
            <div class="row accordion-row" id="accordionMainHeaders">
                <div class="col accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIndividu" aria-controls="collapseIndividu">INDIVIDU</button></h2></div>
                <div class="col accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseKelompok" aria-controls="collapseKelompok">KELOMPOK</button></h2></div>
                <div class="col accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePraAsesmen" aria-controls="collapsePraAsesmen">ASESMEN</button></h2></div>
                <div class="col accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFinalty" aria-controls="collapseFinalty">FINALTY</button></h2></div>
                <div class="col accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLainnya" aria-controls="collapseLainnya">LAINNYA</button></h2></div>
            </div>
        </div>
    </div>
</div>

<div class="container mt-0 mb-5">
<div class="assessment-scroll-area">
<div style="padding-bottom: 80px;">

  <div id="content-peserta" class="assessment-content">
    <form id="form-peserta">
      
      <div class="accordion accordion-content-area" id="accordionPesertaContent">
        <div id="collapseIndividu" class="accordion-collapse collapse" data-bs-parent="#accordionPesertaContent"><div class="accordion-body p-0">
            <h6 class="section-title-box">Penilaian Perlengkapan</h6>
            <div class="row g-1"> 
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Baju Olahraga</span><div class="score-custom-dropdown" data-name="Baju Olahraga"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Baju PDL 1 buah</span><div class="score-custom-dropdown" data-name="Baju PDL"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Baju Putih 1 buah</span><div class="score-custom-dropdown" data-name="Baju Putih"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Baju Bebas 1 buah</span><div class="score-custom-dropdown" data-name="Baju Bebas"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Training 2 buah</span><div class="score-custom-dropdown" data-name="Training"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">ATK + Buku MP</span><div class="score-custom-dropdown" data-name="ATK + Buku MP"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Perlengkapan Makan</span><div class="score-custom-dropdown" data-name="Perlengkapan Makan"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Perlengkapan Sholat</span><div class="score-custom-dropdown" data-name="Perlengkapan Sholat"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Perlengkapan Mandi</span><div class="score-custom-dropdown" data-name="Perlengkapan Mandi"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Koin 5 Keping</span><div class="score-custom-dropdown" data-name="Koin Seribu Perak 5 Keping"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Plastik 3 KG</span><div class="score-custom-dropdown" data-name="Plastik 3 KG"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Sandal</span><div class="score-custom-dropdown" data-name="Sandal"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Name Tag Dada MP</span><div class="score-custom-dropdown" data-name="Name Tag Dada MP + foto"></div></div></div>
            </div>
            <h6 class="section-title-box mt-3">Penilaian Konsumsi</h6>
            <div class="row g-1"> 
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Super bubur 1 pcs</span><div class="score-custom-dropdown" data-name="Super bubur"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Telur 2 butir</span><div class="score-custom-dropdown" data-name="Telur"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Beras 3 gelas</span><div class="score-custom-dropdown" data-name="Beras"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Minyak Bantal 180ml</span><div class="score-custom-dropdown" data-name="Minyak Bantal"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Mie Indomie 2pcs</span><div class="score-custom-dropdown" data-name="Mie Indomie"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Air mineral 1.500 ML</span><div class="score-custom-dropdown" data-name="Air mineral"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Bekal (nasi + lauk)</span><div class="score-custom-dropdown" data-name="Bekal (nasi + lauk)"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Roti Aoka</span><div class="score-custom-dropdown" data-name="Roti Aoka"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Tolak Angin 1 pcs</span><div class="score-custom-dropdown" data-name="Tolak Angin"></div></div></div>
            </div>
          </div>
        </div>

        <div id="collapseKelompok" class="accordion-collapse collapse" data-bs-parent="#accordionPesertaContent">
          <div class="accordion-body p-0">
            <h6 class="section-title-box">Obat - obatan & Konsumsi (Nilai Total Kelompok)</h6>
            <div class="row g-1"> 
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Obat-obatan Kelompok</span><div class="score-custom-dropdown" data-name="Obat-obatan Kelompok"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Konsumsi Kelompok</span><div class="score-custom-dropdown" data-name="Konsumsi Kelompok"></div></div></div>
            </div>
          </div>
        </div>
        
        <div id="collapsePraAsesmen" class="accordion-collapse collapse" data-bs-parent="#accordionPesertaContent">
          <div class="accordion-body p-0">
             <h6 class="section-title-box">Penilaian Pra-Asesmen</h6>
            <div class="row g-1"> 
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Pengetahuan Umum</span><div class="score-custom-dropdown" data-name="Pengetahuan Umum"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Bahasa Lokal</span><div class="score-custom-dropdown" data-name="Bahasa Lokal"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Permainan Edukasi</span><div class="score-custom-dropdown" data-name="Permainan Edukasi"></div></div></div>
            </div>
          </div>
        </div>

        <div id="collapseFinalty" class="accordion-collapse collapse" data-bs-parent="#accordionPesertaContent">
          <div class="accordion-body p-0">
            <h6 class="section-title-box">Penilaian Finalty</h6>
            <div class="row g-1"> 
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Makan Ngobrol</span><div class="score-custom-dropdown" data-name="Makan Ngobrol"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Makanan Tidak habis</span><div class="score-custom-dropdown" data-name="Makanan Tidak habis"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Makan Tidak pakai etika</span><div class="score-custom-dropdown" data-name="Makan Tidak pakai etika"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Kesalahan lain</span><div class="score-custom-dropdown" data-name="Kesalahan lain"></div></div></div>
            </div>
          </div>
        </div>

        <div id="collapseLainnya" class="accordion-collapse collapse" data-bs-parent="#accordionPesertaContent">
          <div class="accordion-body p-0">
            <h6 class="section-title-box">Penilaian Lainnya</h6>
            <div class="row g-1"> 
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Chalenge</span><div class="score-custom-dropdown" data-name="Chalenge"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Obstacle</span><div class="score-custom-dropdown" data-name="Obstacle"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Effort</span><div class="score-custom-dropdown" data-name="Effort"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Critics</span><div class="score-custom-dropdown" data-name="Critics"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Succes Other</span><div class="score-custom-dropdown" data-name="Succes Other"></div></div></div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div id="content-panitia" class="assessment-content" style="display:none;">
    <form id="form-panitia">
      <div class="accordion accordion-content-area" id="accordionPanitiaContent">
        <div id="collapseIndividu" class="accordion-collapse collapse" data-bs-parent="#accordionPanitiaContent">
          <div class="accordion-body p-0">
            <h6 class="section-title-box">Logistik</h6>
            <div class="row g-1"> 
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Koin 1000 5 keping</span><div class="score-custom-dropdown" data-name="Koin 1000"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Beras 1 gelas</span><div class="score-custom-dropdown" data-name="Beras"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Tolak angin 1 buah</span><div class="score-custom-dropdown" data-name="Tolak angin"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Roti ketawa 1 buah</span><div class="score-custom-dropdown" data-name="Roti ketawa"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Minuman sachet berbeda</span><div class="score-custom-dropdown" data-name="Minuman sachet berbeda"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Tepung Terigu 1 Kg</span><div class="score-custom-dropdown" data-name="Tepung Terigu"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Trashbag 1</span><div class="score-custom-dropdown" data-name="Trashbag"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Lilin 1</span><div class="score-custom-dropdown" data-name="Lilin"></div></div></div>
            </div>
          </div>
        </div>

        <div id="collapseKelompok" class="accordion-collapse collapse" data-bs-parent="#accordionPanitiaContent">
          <div class="accordion-body p-0">
            <h6 class="section-title-box">Perlengkapan & Konsumsi Kelompok</h6>
            <div class="row g-1"> 
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Perlengkapan Kelompok</span><div class="score-custom-dropdown" data-name="Perlengkapan Kelompok"></div></div></div>
              <div class="col-12"><div class="input-group input-group-sm penilaian-row"><span class="input-group-text">Konsumsi Kelompok</span><div class="score-custom-dropdown" data-name="Konsumsi Kelompok"></div></div></div>
            </div>
          </div>
        </div>
         <div id="collapsePraAsesmen" class="accordion-collapse collapse" data-bs-parent="#accordionPanitiaContent"></div>
         <div id="collapseFinalty" class="accordion-collapse collapse" data-bs-parent="#accordionPanitiaContent"></div>
         <div id="collapseLainnya" class="accordion-collapse collapse" data-bs-parent="#accordionPanitiaContent"></div>
      </div>
    </form>
  </div>

</div>
</div>
</div>

<div class="d-flex justify-content-evenly sticky-footer">
    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="window.location.reload()">Home</button>
    <button type="button" class="btn btn-secondary btn-sm disabled">Cetak</button>
    <button type="button" class="btn btn-secondary btn-sm disabled">Unduh</button>
    <button type="submit" class="btn btn-primary btn-sm" id="btn-save-peserta" form="form-peserta" style="display: block;">Simpan</button>
    <button type="submit" class="btn btn-primary btn-sm" id="btn-save-panitia" form="form-panitia" style="display: none;">Simpan</button>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1060;">
  <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">Pesan Sistem</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body" id="toast-message"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzuZDCErpR_k3OaCwOpE24-hBQErV_PW__qEQMDvhtFqmUNRgaQQehSvaejgGiLf9I/exec';

  let sheetData = {};
  let currentRole = 'pesertabintal';
  const scoreClasses = ['score-1', 'score-2', 'score-3', 'score-4', 'score-5'];
  
  function calculateTotalScore(role) {
      const form = document.getElementById(`form-${role}`);
      if (!form) return 0;
      
      let total = 0;
      form.querySelectorAll('input[type="hidden"]').forEach(input => {
          if (input.name && !['Unit', 'Kelompok', 'Nama'].includes(input.name)) {
              total += parseInt(input.value) || 0;
          }
      });
      return total;
  }

  function updateTotalScoreDisplay() {
      const scorePeserta = calculateTotalScore('peserta');
      const scorePanitia = calculateTotalScore('panitia');
      
      document.getElementById('total-score-peserta').textContent = scorePeserta;
      document.getElementById('total-score-panitia').textContent = scorePanitia;
  }

  function naturalSort(a, b) {
      const collator = new Intl.Collator(undefined, { numeric: true, sensitivity: 'base' });
      return collator.compare(a, b);
  }
  
  function createCustomDropdown(name, isFinalty = false) {
      const scores = isFinalty ? [0, -1, -2, -3, -4, -5] : [0, 1, 2, 3, 4, 5];
      const initialValue = scores[0]; 
      
      let html = `<button class="score-display-btn" data-value="${initialValue}" type="button">${initialValue}</button>`;
      html += `<div class="score-options-list">`;
      scores.forEach(score => {
          const activeClass = score === initialValue ? 'active' : '';
          html += `<div class="score-option ${activeClass}" data-value="${score}">${score}</div>`;
      });
      html += `</div>`;
      html += `<input type="hidden" name="${name}" value="${initialValue}">`;
      return html;
  }

  function initCustomDropdowns() {
      document.querySelectorAll('.score-custom-dropdown').forEach(dropdown => {
          const name = dropdown.getAttribute('data-name');
          const isFinalty = dropdown.closest('#collapseFinalty'); 

          dropdown.innerHTML = createCustomDropdown(name, !!isFinalty);

          const displayBtn = dropdown.querySelector('.score-display-btn');
          const optionsList = dropdown.querySelector('.score-options-list');
          const hiddenInput = dropdown.querySelector('input[type="hidden"]');
          const options = dropdown.querySelectorAll('.score-option');
          
          displayBtn.addEventListener('click', function(e) {
              e.stopPropagation();
              
              document.querySelectorAll('.score-options-list').forEach(list => {
                  if (list !== optionsList) {
                      list.style.display = 'none';
                  }
              });
              document.querySelectorAll('.identity-options-list').forEach(list => list.style.display = 'none');
              
              optionsList.style.display = optionsList.style.display === 'block' ? 'none' : 'block';
          });

          options.forEach(option => {
              option.addEventListener('click', function() {
                  const value = parseInt(this.getAttribute('data-value'));
                  displayBtn.textContent = value;
                  displayBtn.setAttribute('data-value', value);
                  hiddenInput.value = value;
                  optionsList.style.display = 'none';
                  
                  options.forEach(opt => opt.classList.remove('active'));
                  this.classList.add('active');
                  
                  scoreClasses.forEach(cls => displayBtn.classList.remove(cls));
                  
                  if (value > 0) {
                      displayBtn.classList.add(`score-${value}`);
                  }
                  
                  updateTotalScoreDisplay();
              });
          });
      });
  }
  
  function updateUnitKelompokFields(unit, kelompok) {
    const unitBtn = document.querySelector('#unit-dropdown .identity-display-btn');
    const unitInput = document.getElementById('unit-select');
    const kelompokBtn = document.querySelector('#kelompok-dropdown .identity-display-btn');
    const kelompokInput = document.getElementById('kelompok-select');

    unitBtn.textContent = unit || 'Unit...';
    unitBtn.setAttribute('data-value', unit || '');
    unitInput.value = unit || '';
    
    kelompokBtn.textContent = kelompok || 'Kelompok...';
    kelompokBtn.setAttribute('data-value', kelompok || '');
    kelompokInput.value = kelompok || '';

    document.querySelectorAll('#unit-options-list .identity-option').forEach(opt => {
        opt.classList.toggle('active', opt.getAttribute('data-value') === unit);
    });
    document.querySelectorAll('#kelompok-options-list .identity-option').forEach(opt => {
        opt.classList.toggle('active', opt.getAttribute('data-value') === kelompok);
    });
  }

  function resetNamaSelection() {
    const namaBtn = document.querySelector('#nama-dropdown .identity-display-btn');
    const namaInput = document.getElementById('nama-select');
    const namaList = document.getElementById('nama-options-list');
    
    namaBtn.textContent = 'Pilih Nama...';
    namaBtn.setAttribute('data-value', '');
    namaInput.value = '';
    
    namaList.querySelectorAll('.identity-option').forEach(opt => opt.classList.remove('active'));
    namaList.style.display = 'none'; 
  }

  function filterAndPopulateNama() {
      const unitValue = document.getElementById('unit-select').value;
      const kelompokValue = document.getElementById('kelompok-select').value;
      const namaList = document.getElementById('nama-options-list');
      
      namaList.innerHTML = '';
      
      if (!sheetData[currentRole]) return;

      let filteredData = sheetData[currentRole].filter(item => {
          let matchesUnit = true;
          let matchesKelompok = true;
          
          if (unitValue) {
              matchesUnit = (item.Unit === unitValue);
          }
          
          if (kelompokValue) {
              matchesKelompok = (item.Kelompok === kelompokValue);
          }
          
          return matchesUnit && matchesKelompok;
      });

      filteredData.sort((a, b) => naturalSort(a.Nama, b.Nama));

      if (filteredData.length > 0) {
          let html = '';
          filteredData.forEach(item => {
              html += `<div class="identity-option" data-value="${item.Nama}" data-unit="${item.Unit}" data-kelompok="${item.Kelompok}">${item.Nama}</div>`;
          });
          namaList.innerHTML = html;
      } else if (unitValue || kelompokValue) {
          namaList.innerHTML = '<div class="identity-option" style="color: #6c757d; cursor: default;">Tidak ada Nama yang cocok.</div>';
      }
  }

  function handleIdentityOptionClick(e, targetId) {
      const option = e.target;
      if (!option.classList.contains('identity-option') || option.style.cursor === 'default') return;

      const value = option.getAttribute('data-value');
      const text = option.textContent;

      const dropdown = option.closest('.identity-custom-dropdown');
      const displayBtn = dropdown.querySelector('.identity-display-btn');
      const hiddenInput = dropdown.querySelector('input[type="hidden"]');
      const optionsList = dropdown.querySelector('.identity-options-list');

      displayBtn.textContent = text;
      displayBtn.setAttribute('data-value', value);
      hiddenInput.value = value;
      optionsList.style.display = 'none';
      
      optionsList.querySelectorAll('.identity-option').forEach(opt => opt.classList.remove('active'));
      option.classList.add('active');

      if (targetId === 'unit-select' || targetId === 'kelompok-select') {
          resetNamaSelection(); 
          filterAndPopulateNama(); 
      } else if (targetId === 'nama-select') {
          const unit = option.getAttribute('data-unit');
          const kelompok = option.getAttribute('data-kelompok');
          updateUnitKelompokFields(unit, kelompok);
          
          // FUNGSI BARU: Load data skor dari Google Sheets
          loadScoreData(value);
      }
  }

  function setupIdentityDropdowns() {
    document.querySelectorAll('.identity-custom-dropdown').forEach(dropdown => {
        const displayBtn = dropdown.querySelector('.identity-display-btn');
        const optionsList = dropdown.querySelector('.identity-options-list');
        const targetId = dropdown.getAttribute('data-target-id');

        displayBtn.onclick = function(e) { 
            e.stopPropagation();
            
            document.querySelectorAll('.identity-options-list').forEach(list => {
                if (list !== optionsList) {
                    list.style.display = 'none';
                }
            });
            document.querySelectorAll('.score-options-list').forEach(list => list.style.display = 'none'); 

            optionsList.style.display = optionsList.style.display === 'block' ? 'none' : 'block';
        };

        optionsList.onclick = (e) => handleIdentityOptionClick(e, targetId);
    });

    document.addEventListener('click', function() {
        document.querySelectorAll('.identity-options-list').forEach(list => list.style.display = 'none');
        document.querySelectorAll('.score-options-list').forEach(list => list.style.display = 'none');
    });
  }

  function resetScoreInputs(closeAccordion = true) {
    if (closeAccordion) {
        closeAllAccordions();
    }
    document.querySelectorAll('.score-custom-dropdown').forEach(dropdown => {
        const displayBtn = dropdown.querySelector('.score-display-btn');
        const hiddenInput = dropdown.querySelector('input[type="hidden"]');
        const initialValue = 0;

        displayBtn.textContent = initialValue;
        displayBtn.setAttribute('data-value', initialValue);
        hiddenInput.value = initialValue;
        
        dropdown.querySelectorAll('.score-option').forEach(opt => opt.classList.remove('active'));
        const initialOption = dropdown.querySelector(`.score-option[data-value="${initialValue}"]`);
        if (initialOption) initialOption.classList.add('active');
        
        scoreClasses.forEach(cls => displayBtn.classList.remove(cls));
    });
    updateTotalScoreDisplay(); 
  }

  function resetIdentityInputs() {
    updateUnitKelompokFields('', ''); 
    resetNamaSelection();
    
    document.querySelector('#unit-dropdown .identity-display-btn').textContent = 'Unit...';
    document.querySelector('#kelompok-dropdown .identity-display-btn').textContent = 'Kelompok...';
    
    filterAndPopulateNama(); 
  }

  function showToast(message, isSuccess = true) {
    const toastEl = document.getElementById('liveToast');
    const toastHeader = toastEl.querySelector('.toast-header');
    
    toastHeader.classList.remove('text-bg-danger', 'text-bg-success');
    
    if (isSuccess) {
        toastHeader.classList.add('text-bg-success');
    } else {
        toastHeader.classList.add('text-bg-danger');
    }
    
    document.getElementById('toast-message').textContent = message;
    const toast = new bootstrap.Toast(toastEl);
    toast.show();
  }

  function closeAllAccordions() {
      document.querySelectorAll('.accordion-collapse.show').forEach(el => {
          new bootstrap.Collapse(el, { toggle: false }).hide();
      });
      document.querySelectorAll('#accordionMainHeaders .accordion-button').forEach(btn => btn.classList.add('collapsed'));
      document.querySelectorAll('.score-options-list').forEach(list => list.style.display = 'none');
      document.querySelectorAll('.identity-options-list').forEach(list => list.style.display = 'none');
  }
  
  function setupAccordionMapping() {
      const headerButtons = document.querySelectorAll('#accordionMainHeaders .accordion-button');
      
      headerButtons.forEach(button => {
          button.onclick = null;
          button.addEventListener('click', function(e) {
              e.preventDefault(); 
              
              const isCollapsed = this.classList.contains('collapsed');
              const collapseId = this.getAttribute('data-bs-target'); 
              
              closeAllAccordions();
              
              if (isCollapsed) {
                  const contentContainerId = (currentRole === 'pesertabintal') ? 'accordionPesertaContent' : 'accordionPanitiaContent';
                  const targetContentEl = document.querySelector(`#${contentContainerId} > ${collapseId}`);
                  
                  const disabledForPanitia = ['#collapsePraAsesmen', '#collapseFinalty', '#collapseLainnya'];
                  if (currentRole === 'panitia' && disabledForPanitia.includes(collapseId)) {
                      showToast('Kategori ini tidak tersedia untuk Panitia.', false);
                      return; 
                  }
                  
                  if (targetContentEl) {
                      const bsCollapse = new bootstrap.Collapse(targetContentEl, { toggle: false });
                      bsCollapse.show();
                      this.classList.remove('collapsed');
                      document.querySelector('.assessment-scroll-area').scrollTop = 0;
                  }
              }
          });
      });
  }

  function switchTab(role) {
    currentRole = role;
    document.getElementById('tab-peserta').classList.remove('active');
    document.getElementById('tab-panitia').classList.remove('active');
    document.getElementById(`tab-${role}`).classList.add('active');

    document.getElementById('content-peserta').style.display = (role === 'peserta') ? 'block' : 'none';
    document.getElementById('content-panitia').style.display = (role === 'panitia') ? 'block' : 'none';
    
    document.getElementById('btn-save-peserta').style.display = (role === 'peserta') ? 'block' : 'none';
    document.getElementById('btn-save-panitia').style.display = (role === 'panitia') ? 'block' : 'none';
    
    populateIdentity(sheetData[role], sheetData.units, sheetData.kelompok);
    
    closeAllAccordions();
    
    const categoriesToDisable = ['#collapsePraAsesmen', '#collapseFinalty', '#collapseLainnya'];
    categoriesToDisable.forEach(collapseId => {
        const button = document.querySelector(`[data-bs-target="${collapseId}"]`);
        if (button) {
            if (role === 'panitia') {
                button.classList.add('disabled');
            } else {
                button.classList.remove('disabled');
            }
        }
    });

    setupAccordionMapping();
    updateTotalScoreDisplay();
  }

  function populateIdentity(data, units, kelompok) {
    const unitList = document.getElementById('unit-options-list');
    const kelompokList = document.getElementById('kelompok-options-list');

    unitList.innerHTML = '';
    kelompokList.innerHTML = '';
    
    const createOption = (value, text) => `<div class="identity-option" data-value="${value}">${text}</div>`;

    if (units) {
        units.sort(naturalSort);
        units.forEach(u => unitList.innerHTML += createOption(u, u));
    }
    if (kelompok) {
        kelompok.sort(naturalSort);
        kelompok.forEach(k => kelompokList.innerHTML += createOption(k, k));
    }
    
    resetIdentityInputs();
    filterAndPopulateNama(); 
    
    setupIdentityDropdowns(); 
  }
  
  function fetchListData() {
    return fetch(APPS_SCRIPT_URL + '?action=getListData')
        .then(response => {
            if (!response.ok) {
                throw new Error(`Kesalahan Jaringan: ${response.status} - ${response.statusText}`);
            }
            return response.json();
        })
        .then(jsonResponse => {
            if (jsonResponse.success) {
                return jsonResponse.data;
            } else {
                throw new Error(jsonResponse.message || 'Respons server Apps Script gagal.');
            }
        })
        .catch(error => {
            console.error('Error fetching list data:', error);
            showToast(`Gagal memuat data dari Sheets: ${error.message}.`, false);
            return null;
        });
  }

  // FUNGSI BARU: Load data skor dari Google Sheets
  function loadScoreData(nama) {
    if (!nama) return;
    
    console.log('Loading score data for:', nama, 'role:', currentRole);
    
    // Tampilkan loading indicator
    const saveBtn = document.getElementById(`btn-save-${currentRole}`);
    const originalText = saveBtn.innerHTML;
    saveBtn.innerHTML = 'Load..';
    saveBtn.disabled = true;
    
    fetch(APPS_SCRIPT_URL + `?action=getScoreData&nama=${encodeURIComponent(nama)}&role=${currentRole}`)
        .then(response => response.json())
        .then(jsonResponse => {
            console.log('Response from server:', jsonResponse);
            console.log('Response success:', jsonResponse.success);
            console.log('Response data:', jsonResponse.data);
            console.log('Response message:', jsonResponse.message);
            
            if (jsonResponse.success && jsonResponse.data) {
                const scoreData = jsonResponse.data;
                console.log('Score data loaded:', scoreData);
                console.log('Available fields in scoreData:', Object.keys(scoreData));
                
                // Reset dulu semua ke 0
                resetScoreInputs(false);
                
                // Isi semua input dengan data dari Google Sheets
                const form = document.getElementById(`form-${currentRole}`);
                let dataFound = false;
                let fieldsLoaded = 0;
                
                // Loop semua dropdown yang ada di form aktif saat ini
                form.querySelectorAll('.score-custom-dropdown').forEach(dropdown => {
                    const name = dropdown.getAttribute('data-name');
                    const valueInData = scoreData[name];
                    
                    console.log(`Field: "${name}" | Value in data: ${valueInData} | Type: ${typeof valueInData}`);
                    
                    // Cek apakah value ada dan bukan 0/null/undefined/empty string
                    if (valueInData !== undefined && valueInData !== null && valueInData !== '') {
                        let value = 0;
                        
                        // Konversi ke number
                        if (typeof valueInData === 'number') {
                            value = valueInData;
                        } else if (typeof valueInData === 'string') {
                            value = parseInt(valueInData);
                            if (isNaN(value)) value = 0;
                        }
                        
                        console.log(`  â†’ Setting value: ${value} for field: "${name}"`);
                        
                        const displayBtn = dropdown.querySelector('.score-display-btn');
                        const hiddenInput = dropdown.querySelector('input[type="hidden"]');
                        const options = dropdown.querySelectorAll('.score-option');
                        
                        if (displayBtn && hiddenInput) {
                            // Update display dan hidden input
                            displayBtn.textContent = value;
                            displayBtn.setAttribute('data-value', value);
                            hiddenInput.value = value;
                            
                            // Update active option
                            options.forEach(opt => opt.classList.remove('active'));
                            const activeOption = dropdown.querySelector(`.score-option[data-value="${value}"]`);
                            if (activeOption) {
                                activeOption.classList.add('active');
                                console.log(`  â†’ Active option set for value: ${value}`);
                            } else {
                                console.log(`  â†’ WARNING: No option found for value: ${value}`);
                            }
                            
                            // Update warna
                            scoreClasses.forEach(cls => displayBtn.classList.remove(cls));
                            if (value > 0 && value <= 5) {
                                displayBtn.classList.add(`score-${value}`);
                            }
                            
                            dataFound = true;
                            fieldsLoaded++;
                        } else {
                            console.log(`  â†’ ERROR: Button or input not found for field: "${name}"`);
                        }
                    }
                });
                
                updateTotalScoreDisplay();
                console.log(`Total fields loaded: ${fieldsLoaded}`);
                
                if (dataFound) {
                    showToast(`Data ${nama} berhasil dimuat! (${fieldsLoaded} field terisi)`, true);
                } else {
                    showToast(`Tidak ada data skor untuk ${nama}. Mulai dengan nilai kosong.`, true);
                }
            } else {
                console.log('No existing data found for:', nama);
                resetScoreInputs(false);
                showToast(`Tidak ada data untuk ${nama}. Mulai dengan nilai kosong.`, true);
            }
            
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        })
        .catch(error => {
            console.error('Error loading score data:', error);
            showToast('Gagal memuat data skor. Memulai dengan nilai kosong.', false);
            resetScoreInputs(false);
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        });
  }

  function handleFormSubmission(e) {
    e.preventDefault();
    const form = this;
    
    const unitValue = document.getElementById('unit-select').value;
    const kelompokValue = document.getElementById('kelompok-select').value;
    const selectedNama = document.getElementById('nama-select').value;
    
    if (!selectedNama) {
        showToast('Mohon pilih Nama terlebih dahulu!', false);
        return;
    }
    
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    data.Unit = unitValue;
    data.Kelompok = kelompokValue;
    data.Nama = selectedNama;
    
    const saveBtn = document.getElementById(`btn-save-${currentRole}`);
    const action = (currentRole === 'pesertabintal') ? 'savePesertaScores' : 'savePanitiaScores';
    
    for (const key in data) {
        if (data[key] === "") {
            delete data[key];
        }
        if (key !== 'Unit' && key !== 'Kelompok' && key !== 'Nama' && data[key] !== undefined) {
             data[key] = parseInt(data[key]);
        }
    }

    console.log('Sending data:', data);
    saveBtn.disabled = true;
    saveBtn.innerHTML = 'â³ Menyimpan...';

    fetch(APPS_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            action: action,
            data: JSON.stringify(data)
        })
    })
    .then(response => {
        console.log('Response received (no-cors mode)');
        
        // Karena mode no-cors, kita asumsikan sukses jika tidak ada error
        showToast(`Data ${selectedNama} berhasil disimpan!`, true);
        
        // Reset form setelah sukses
        resetScoreInputs(); 
        resetIdentityInputs();
        
        saveBtn.disabled = false;
        saveBtn.innerHTML = 'Simpan';
    })
    .catch(error => {
        console.error('Error saving scores:', error);
        
        // Bahkan jika ada "error" di no-cors, data mungkin tetap tersimpan
        // Jadi kita tampilkan pesan yang lebih netral
        showToast(`Data telah dikirim. Silakan cek Google Sheets untuk memastikan.`, true);
        
        // Tetap reset form
        resetScoreInputs(); 
        resetIdentityInputs();
        
        saveBtn.disabled = false;
        saveBtn.innerHTML = 'Simpan';
    });
  }

  document.addEventListener('DOMContentLoaded', async () => {
    initCustomDropdowns(); 
    setupIdentityDropdowns(); 
    
    const data = await fetchListData();
    if (data) {
        sheetData = data;
        populateIdentity(sheetData.peserta, sheetData.units, sheetData.kelompok);
    }
    document.getElementById('form-peserta').addEventListener('submit', handleFormSubmission);
    document.getElementById('form-panitia').addEventListener('submit', handleFormSubmission);
    
    setupAccordionMapping();
    updateTotalScoreDisplay();
  });
</script>
<script>
function renderUnit() {
  if (!Array.isArray(peserta) || peserta.length === 0) return;

  const units = [...new Set(peserta.map(p => p.Unit))];
  listUnit.innerHTML = units
    .map(u => `<div onclick="pilihUnit('${u}')">${u}</div>`)
    .join("");
}

function pilihUnit(unit) {
  setValue("unit", unit);
  renderKelompok(unit);
}

function renderKelompok(unit) {
  const list = document.getElementById("kelompok-options-list");
  list.innerHTML = "";
  Object.keys(DATA_IDENTITAS[unit]).forEach(kelompok => {
    const div = document.createElement("div");
    div.textContent = kelompok;
    div.onclick = () => pilihKelompok(unit, kelompok);
    list.appendChild(div);
  });
}

function pilihKelompok(unit, kelompok) {
  setValue("kelompok", kelompok);
  renderNama(unit, kelompok);
}

function renderNama(unit, kelompok) {
  const list = document.getElementById("nama-options-list");
  list.innerHTML = "";
  DATA_IDENTITAS[unit][kelompok].forEach(nama => {
    const div = document.createElement("div");
    div.textContent = nama;
    div.onclick = () => setValue("nama", nama);
    list.appendChild(div);
  });
}

function setValue(id, val) {
  document.getElementById(id + "-select").value = val;
  document.querySelector("#" + id + "-dropdown button").textContent = val;
}
</script>
<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbzuZDCErpR_k3OaCwOpE24-hBQErV_PW__qEQMDvhtFqmUNRgaQQehSvaejgGiLf9I/exec";

let peserta = [];

fetch(GAS_URL + "?action=getPeserta")
  .then(res => res.text())
  .then(txt => {
    let data;
    try {
      data = JSON.parse(txt);
    } catch (e) {
      throw new Error("Respon bukan JSON: " + txt);
    }

    if (!Array.isArray(data)) {
      throw new Error("Data bukan array: " + JSON.stringify(data));
    }

    peserta = data;
    renderUnit(); // fungsi dropdown Anda
  })
  .catch(err => {
    console.error(err);
    alert("Gagal memuat data dari Sheets");
  });

function renderUnit(){
  const u = [...new Set(peserta.map(x=>x.Unit))];
  listUnit.innerHTML = u.map(v=>`<div onclick="pilihUnit('${v}')">${v}</div>`).join("");
}

btnUnit.onclick=()=>listUnit.style.display='block';
btnKelompok.onclick=()=>listKelompok.style.display='block';
btnNama.onclick=()=>listNama.style.display='block';

function pilihUnit(v){
  Unit.value=v; btnUnit.innerText=v;
  listUnit.style.display='none';
  const k = [...new Set(peserta.filter(x=>x.Unit==v).map(x=>x.Kelompok))];
  listKelompok.innerHTML = k.map(v=>`<div onclick="pilihKelompok('${v}')">${v}</div>`).join("");
}

function pilihKelompok(v){
  Kelompok.value=v; btnKelompok.innerText=v;
  listKelompok.style.display='none';
  const n = peserta.filter(x=>x.Unit==Unit.value && x.Kelompok==v);
  listNama.innerHTML = n.map(v=>`<div onclick="pilihNama('${v.Nama}')">${v.Nama}</div>`).join("");
}

function pilihNama(v){
  Nama.value=v; btnNama.innerText=v;
  listNama.style.display='none';
}

function simpan(){
  if(!Unit.value||!Kelompok.value||!Nama.value){alert("Identitas belum lengkap");return;}
  const payload={
    Unit:Unit.value,
    Kelompok:Kelompok.value,
    Nama:Nama.value
  };
  fetch(GAS_URL,{
    method:"POST",
    body:JSON.stringify(payload)
  }).then(r=>r.text()).then(a=>alert(a));
}
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  // === AMBIL ELEMENT DULU ===
  window.btnUnit = document.getElementById("btnUnit");
  window.btnKelompok = document.getElementById("btnKelompok");
  window.btnNama = document.getElementById("btnNama");

  window.listUnit = document.getElementById("listUnit");
  window.listKelompok = document.getElementById("listKelompok");
  window.listNama = document.getElementById("listNama");

  window.Unit = document.getElementById("Unit");
  window.Kelompok = document.getElementById("Kelompok");
  window.Nama = document.getElementById("Nama");

  window.peserta = [];

  // === FETCH DATA PESERTA ===
  fetch(GAS_URL + "?action=getPeserta")
    .then(res => res.text())
    .then(txt => {
      const data = JSON.parse(txt);
      if (!Array.isArray(data)) throw new Error("Data bukan array");
      peserta = data;
      renderUnit();
    })
    .catch(err => {
      console.error(err);
      alert("Gagal memuat data dari Sheets");
    });

});
</script>

</body>
</html>
