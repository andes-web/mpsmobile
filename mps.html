<script>
(function(){
  function isMobile() { return window.innerWidth <= 768; }

  function insertRekapOnce(){
    if(!isMobile()) return;
    const sidebar=document.getElementById('sidebar-left')||document.querySelector('.sidebar-left');
    if(!sidebar)return;

    // cari posisi "Penilaian Individu"
    let target=null;
    const all=sidebar.querySelectorAll('*');
    for(const el of all){
      if(el.childElementCount===0 && el.textContent && el.textContent.trim()==='Penilaian Individu'){
        target=el;break;
      }
    }
    if(!target)return;
    if(sidebar.querySelector('.rekap-nilai-item'))return;

    const item=document.createElement('div');
    item.className='h4-button rekap-nilai-item';
    item.textContent='üìä Rekap Nilai';
    item.style.cursor='pointer';
    item.style.padding='6px 8px';
    item.style.margin='4px 0';
    item.style.borderBottom='1px solid rgba(0,0,0,0.06)';
    target.insertAdjacentElement('beforebegin',item);

    // Klik: muat rightsidebar di konten utama
    item.addEventListener('click',function(e){
      e.preventDefault();
      const content=document.getElementById('content')||document.querySelector('.content');
      if(!content)return;

      // kosongkan isi konten & buat iframe
      content.innerHTML='';
      const iframe=document.createElement('iframe');
      iframe.src='rightsidebar.html';
      iframe.id='rekapFrame';
      iframe.sandbox='allow-same-origin allow-scripts allow-top-navigation allow-forms';
      iframe.scrolling='auto';
      iframe.style.position='relative';
      iframe.style.display='block';
      iframe.style.border='none';
      iframe.style.margin='0';
      iframe.style.padding='0';
      iframe.style.width='100vw';
      iframe.style.height='100vh';
      iframe.style.left='0';
      iframe.style.top='0';
      iframe.style.background='white';
      iframe.style.zIndex='99';
      iframe.style.transition='opacity .4s ease';
      iframe.style.opacity='0';
      content.appendChild(iframe);
      requestAnimationFrame(()=>iframe.style.opacity='1');

      // Scroll ke atas
      window.scrollTo(0,0);

      // Terapkan mode paksa penuh
      forceFullWidth();
    });
  }

  // Fungsi paksa: hilangkan padding/margin semua kontainer utama
  function forceFullWidth(){
    if(!isMobile()) return;
    const html=document.documentElement;
    const body=document.body;
    const content=document.getElementById('content')||document.querySelector('.content');
    [html,body,content].forEach(el=>{
      if(!el)return;
      el.style.margin='0';
      el.style.padding='0';
      el.style.width='100vw';
      el.style.maxWidth='100vw';
      el.style.overflowX='hidden';
    });
    const iframe=document.getElementById('rekapFrame');
    if(iframe){
      iframe.style.width='100vw';
      iframe.style.height='100vh';
    }
  }

  document.addEventListener('DOMContentLoaded',insertRekapOnce);

  // pantau jika sidebar dibentuk dinamis
  const mo=new MutationObserver(insertRekapOnce);
  mo.observe(document.body,{childList:true,subtree:true});

  // pantau perubahan ukuran layar
  window.addEventListener('resize',()=>{
    if(isMobile()) forceFullWidth();
  });
})();
</script>

<style>
/* üåê Mobile-only CSS paksa */
@media (max-width:768px){
  html,body,#content,.content{
    margin:0!important;
    padding:0!important;
    width:100vw!important;
    max-width:100vw!important;
    overflow-x:hidden!important;
    background:#fff!important;
  }
  #rekapFrame, #content iframe, .content iframe{
    display:block!important;
    border:none!important;
    width:100vw!important;
    height:100vh!important;
    margin:0!important;
    padding:0!important;
    background:#fff!important;
  }
}
</style>
