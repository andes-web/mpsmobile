<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RUBRIK ASESMENT SPREADSHEET</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
:root{
  --bg: #fff5fc;
  --accent: #000000;
  --muted: #334e68;
  --card: #ffffff;
  --input: #f7f9fc;
  --nav-bg: #ffcefd;
  --shadow-light: rgba(0,0,0,0.05);
  --primary:#b30077;
  --deep-blue:#003366;
  --light-blue:#e9f2ff;
  --green-pass: #008000; /* Hijau untuk nilai >= 80 */
}
*{box-sizing:border-box; transition: all 0.2s ease-out;}
body{font-family:"Segoe UI",system-ui,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--muted);font-size:13px}

/* HEADER */
header{
  position:fixed;top:0;left:0;right:0;
  background:linear-gradient(90deg,#ff00b3,var(--primary));
  color:#fff;padding:8px;z-index:220;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
  display:flex;align-items:center;gap:8px;
}
header h1{margin:0;font-weight:700;font-size:15px;flex:1;text-align:center}
.home-icon-link{color:#fff;text-decoration:none;font-size:17px;padding:0 4px}

/* IDENTITY BAR */
.identity-bar{
  position:fixed;top:44px;left:0;right:0;
  background:var(--nav-bg);padding:6px 8px;z-index:215;
  border-bottom:1px solid #dcdfe4;
  box-shadow:0 1px 3px var(--shadow-light);
}
.identity-inner{
  max-width:980px;margin:0 auto;
  display:flex;align-items:flex-start;justify-content:space-between;
  gap:8px;flex-wrap:nowrap;
}
.identity-left{display:flex;flex-direction:column;gap:6px;flex:1 1 auto;}

/* Label container */
.identity-toplabel-container{
  background:var(--light-blue);
  border-radius:6px;
  box-shadow:inset 1px 1px 3px rgba(0,0,0,0.08),
             inset -1px -1px 3px rgba(255,255,255,0.7);
  padding:4px 8px;
  text-align:center;
  border:1px solid #c6d6f5;
}
.identity-toplabel{
  font-weight:700;font-size:14px;
  color:var(--deep-blue);
  letter-spacing:0.2px;
  white-space:nowrap;
}

/* FORM CONTAINER */
.identity-form-container{
  background:#fff;
  border:1px solid #d3dae7;
  border-radius:8px;
  padding:6px 8px;
  box-shadow:inset 1px 1px 2px rgba(0,0,0,0.04),
             inset -1px -1px 2px rgba(255,255,255,0.6);
}
.identity-row{display:flex;gap:6px;align-items:center;flex-wrap:nowrap;margin-bottom:4px;}
.identity-field{display:flex;flex-direction:column;gap:2px;flex:1 1 48%;}
label{font-weight:700;font-size:12.5px;color:var(--muted);}
input[type="text"],select{
  width:100%;padding:6px 8px;border-radius:5px;border:1px solid #c9d6e4;
  background:var(--input);font-size:12.5px;color:var(--muted);
}
input[type="text"]:focus,select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 2px rgba(179,0,119,0.08);}

/* SCORE PANEL */
.score-panel{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
  padding:8px 6px;border-radius:6px;background:#fff;
  border:1px solid rgba(179,0,119,0.12);
  box-shadow:0 2px 5px rgba(0,0,0,0.03);
  flex-shrink:0;min-width:85px;max-width:95px;
}
.score-pill{
  display:block;padding:5px 0;width:50px;text-align:center;
  border-radius:4px;background:linear-gradient(180deg,#fff,#fff5fc);
  border:1px solid rgba(179,0,119,0.08);
  font-weight:700;color:var(--primary);font-size:16px;
}
/* STYLE BARU UNTUK NILAI >= 80 */
.score-pill.pass {
    color: var(--green-pass);
    font-weight: 900;
    border-color: var(--green-pass);
    background: #e6ffe6;
}
.score-label{
  font-size:16px;
  color:#444;
  margin-top:1px;
  font-weight:700;
  margin-bottom: 2px;
}

/* MOBILE */
@media(max-width:640px){
  .identity-inner{align-items:flex-start;gap:5px;}
  .identity-row{gap:5px;}
  .identity-field{flex:1 1 48%;}
  .score-panel{min-width:65px;max-width:75px;padding:3px;}
  .score-pill{width:50px;font-size:16px;padding:0px 0;}
  .score-label{font-size:12px;}
}

/* --- FIXED NAVIGATION CSS --- */
.question-nav-fixed-bar {
    position: fixed;
    /* TETAP: Nilai desktop */
    top: 170px; 
    left: 0;
    right: 0;
    background: #fff; 
    padding: 3px 0;
    z-index: 200; 
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid #e0e8f0;
}
.fixed-nav-inner {
    max-width: 980px;
    margin: 0 auto;
    text-align: center;
    padding: 0 10px;
    display: flex;
    flex-wrap: wrap; 
    justify-content: center;
    gap: 4px; 
}
.fixed-nav-inner button{
    display:inline-block;
    margin:0; 
    padding:4px 6px; 
    border-radius:4px;
    border:none;
    background:#fff5fc;
    color:#b3009b;
    font-size:11px;
    cursor:pointer;
    min-width:28px; 
    font-weight: 600; 
    box-shadow: 0 1px 2px var(--shadow-light);
    flex-shrink: 0; 
}
.fixed-nav-inner button:hover { background: #c6daff; }
.fixed-nav-inner button.current-q { background: var(--accent)!important; color: #fff!important; box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3);}

.main{
  max-width:980px;
  margin:0 auto;
  /* TETAP: Nilai desktop */
  padding:210px 10px 80px; 
} 

.question-card{background:var(--card);border-left:4px solid var(--accent);padding:10px; border-radius:8px;margin-bottom:15px; box-shadow:0 4px 8px var(--shadow-light); position: relative;}
.q-text{
  font-size:18px; 
  margin:0 0 6px 0;
  font-weight:700;
  color:var(--accent);
} 
.options{display:flex;flex-direction:column;gap:4px} 
.opt{display:flex;align-items:flex-start;gap:8px;padding:6px 8px; border-radius:6px;background:var(--input);border:1px solid #e0e8f0;font-size:17px; cursor: pointer; position: relative;} 
.opt:hover{background: #eaf1fa; border-color: #c9cde4;}

.opt input[type="radio"]:checked + span {font-weight: 700;color: #0056b3;}
.opt input[type="radio"]{display: none;}
.opt.checked-option {
    background: #e8f0fe;
    border: 2px solid var(--accent);
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); 
}
.opt span{
  display:block;
  font-weight:400;
  color:var(--muted);
  font-size:14px; 
  line-height:1.25; 
} 

.fixed-send{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(90deg, #ff00d4, #b300a4);padding:8px 10px; z-index:230;box-shadow:0 -2px 8px rgba(0,0,0,0.1);}
.fixed-inner{max-width:980px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:10px}
.footer-note { color: #fff; font-size: 11px; font-weight: 400; margin: 0;} 
.btn-send{background:#fff;color:var(--accent);padding:8px 12px; border-radius:6px;border:none;font-weight:700;cursor:pointer; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);}
.btn-send:hover{background:#f0f0f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);}
.btn-send:active{transform: translateY(1px);}

@media (max-width:480px){
  /* FIX BARU: Penyesuaian padding-top & nav bar untuk mobile */
  .main{padding-top:280px;padding-bottom:70px} /* Ditingkatkan dari 230px ke 240px */
  .identity-bar{top:44px;}
  .question-nav-fixed-bar { top: 240px; } /* Ditingkatkan dari 190px ke 200px */
  .fixed-nav-inner button{padding:3px 5px; min-width:24px; font-size:13px;}
  .nav-soal { margin-top: 70px !important; }
}

/* Tambahkan style untuk pesan peringatan jika Sesi belum dipilih */
.alert-sesi {
    background-color: #f8d7da; 
    color: #721c24; 
    padding: 8px 10px;
    border-radius: 6px;
    margin-top: 10px;
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    border: 1px solid #f5c6cb;
}
select option { padding:2px 4px !important; line-height:1 !important; }
select{ scrollbar-width: thin; }
select::-webkit-scrollbar{ width:4px; }
select::-webkit-scrollbar-thumb{ background:#ccc; border-radius:4px; }
@keyframes slideUp{from{transform:translateY(100%);}to{transform:translateY(0);} }

/* CSS BARU UNTUK FLOATING MENU */
#floating-menu {
    position: absolute;
    top: 44px; /* Tepat di bawah header */
    right: 8px; /* Sejajar dengan tombol */
    background: var(--card);
    border: 1px solid #ddd;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 235; /* Lebih tinggi dari elemen lain */
    min-width: 150px;
    display: none;
    animation: fadeIn 0.15s ease-out;
}
#floating-menu a {
    display: block;
    padding: 8px 12px;
    color: var(--muted);
    text-decoration: none;
    font-size: 13px;
    font-weight: 600;
    white-space: nowrap;
}
#floating-menu a:hover {
    background: #f7f7f7;
    color: var(--primary);
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>
<header>
  <a href="https://andes-web.github.io/mpsmobile/" target="_blank" class="home-icon-link" title="Beranda">
    üè†
  </a>
  
  <h1>RUBRIK ASESMENT SPREADSHEET</h1>
  
  <button id="menu-btn" type="button" style="background:none; border:none; color:#fff; font-size:17px; cursor:pointer; padding:0 4px;" title="Menu Lain">
    ‚ò∞
  </button>
  <div id="floating-menu">
    <a href="https://andes-web.github.io/mpsmobile/solo/spreadsheet.html" target="_blank">
      Formulir Refleksi
    </a>
  </div>
  </header>

<div class="identity-bar">
  <div class="identity-inner">

    <div class="identity-left">
      <div class="identity-toplabel-container">
        <div class="identity-toplabel">Pilih ASESMEN untuk rubrik penilaian</div>
      </div>

      <div class="identity-form-container">
    <div class="identity-row">
      <div class="identity-field">
        <label for="kelas">Kelas</label>
        <select id="kelas" name="kelas" required>
          <option value="">Pilih Kelas</option>
          <option value="KELAS X AKL1">KELAS X AKL1</option>
          <option value="KELAS X AKL2">KELAS X AKL2</option>
          <option value="KELAS X AKL3">KELAS X AKL3</option>
          <option value="KELAS X AKL4">KELAS X AKL4</option>
        </select>
      </div>
      <div class="identity-field">
        <label for="sesi">Asesmen</label>
        <select id="sesi" name="sesi" required>
          <option value="">Pilih Asesmen</option>
          <option value="As Learning">As Learning</option>
          <option value="For Learning">For Learning</option>
          <option value="Of Learning">Of Learning</option>
        </select>
      </div>
    </div>
    <div class="identity-field">
      <label for="nama" class="label-nama">Nama Peserta Didik</label>
      <select id="nama" name="nama" required>
          <option value="" disabled selected>Pilih Kelas dahulu</option>
      </select>
      </div>
    </div>
</div>

<div class="score-panel">
      <div id="panel-as"><div class="score-label">As</div><div class="score-pill" id="score-as">-</div></div>
      <div id="panel-for"><div class="score-label">For</div><div class="score-pill" id="score-for">-</div></div>
      <div id="panel-of"><div class="score-label">Of</div><div class="score-pill" id="score-of">-</div></div>
      <div id="panel-akhir"><div class="score-label">Akhir</div><div class="score-pill" id="score-akhir">-</div></div>
    </div>
  </div>
</div>

<div class="question-nav-fixed-bar">
  <div class="fixed-nav-inner" id="fixedNavButtons">
  </div>
</div>

<main class="main">
  <form id="refleksiForm" method="POST" action="https://script.google.com/macros/s/AKfycbxe1KHyxGBwPg5tQ7dIztRMX7cttmp0LN1u0R1_b9o08RjBXaA0ewZCgMjC9xWIypZD/exec">
    <div id="questions">
      </div>
  </form>
</main>

<div class="fixed-send">
  <div class="fixed-inner">
    <p class="footer-note">@2025 Andes</p>
    <div style="display:flex; gap: 8px;">
        <button id="btnNext" class="btn-send" type="button">KIRIM RUBRIK</button>
        <button id="btnReset" class="btn-send" type="button" style="background: #f0f0f0; color: var(--primary); border: 1px solid var(--primary);">RESET</button>
    </div>
  </div>
</div>

<script>
// DATA SISWA DIAMBIL LANGSUNG DARI GOOGLE SHEET YANG DIBERIKAN
const ALL_STUDENTS_DATA = [
  {"kelas":"KELAS X AKL1","nama":"Abel Oktafiani"},
  {"kelas":"KELAS X AKL1","nama":"Adilla Surgaloka"},
  {"kelas":"KELAS X AKL1","nama":"Adinda Risma Sari"},
  {"kelas":"KELAS X AKL1","nama":"Alika Akilah"},
  {"kelas":"KELAS X AKL1","nama":"Almira Najma Tazkia Amin"},
  {"kelas":"KELAS X AKL1","nama":"Angga Sanjaya"},
  {"kelas":"KELAS X AKL1","nama":"Aqilla Aisyah Putri"},
  {"kelas":"KELAS X AKL1","nama":"Ariska Putri"},
  {"kelas":"KELAS X AKL1","nama":"Ayub Bernaken Lumban Gaol"},
  {"kelas":"KELAS X AKL1","nama":"Chabita Keysia"},
  {"kelas":"KELAS X AKL1","nama":"Chika Inayah"},
  {"kelas":"KELAS X AKL1","nama":"Desvita Marshellena"},
  {"kelas":"KELAS X AKL1","nama":"Diandra Wardhatul Farha"},
  {"kelas":"KELAS X AKL1","nama":"Dila Putri Ferdiansyah"},
  {"kelas":"KELAS X AKL1","nama":"Dimas Abdul Khoir"},
  {"kelas":"KELAS X AKL1","nama":"Dwi Nefta Amanda Putri"},
  {"kelas":"KELAS X AKL1","nama":"Faisal Muttaqin"},
  {"kelas":"KELAS X AKL1","nama":"Febyolla Putri Hardillah"},
  {"kelas":"KELAS X AKL1","nama":"Gracia Aurora Tesalonika Yance"},
  {"kelas":"KELAS X AKL1","nama":"Hanif Assyatir"},
  {"kelas":"KELAS X AKL1","nama":"Jesika Melia Putri"},
  {"kelas":"KELAS X AKL1","nama":"Kanaya Oktaviani"},
  {"kelas":"KELAS X AKL1","nama":"Keysha Nur Syahira"},
  {"kelas":"KELAS X AKL1","nama":"Khaila Nuriyah"},
  {"kelas":"KELAS X AKL1","nama":"Miftahul Nur Alfi"},
  {"kelas":"KELAS X AKL1","nama":"Muhammad Fadli"},
  {"kelas":"KELAS X AKL1","nama":"Muhammad Fauzan"},
  {"kelas":"KELAS X AKL1","nama":"Muhammad Rozak Nur Fajar"},
  {"kelas":"KELAS X AKL1","nama":"Mustika Kirania Putri"},
  {"kelas":"KELAS X AKL1","nama":"Mutiara Kusuma Dewi"},
  {"kelas":"KELAS X AKL1","nama":"Nabila Illa Tresna"},
  {"kelas":"KELAS X AKL1","nama":"Rafka Jaya Wibowo"},
  {"kelas":"KELAS X AKL1","nama":"Raina Azalla"},
  {"kelas":"KELAS X AKL1","nama":"Ratu Bilqis Khairunisa"},
  {"kelas":"KELAS X AKL1","nama":"Riqza Maulana Hidayatulloh"},
  {"kelas":"KELAS X AKL1","nama":"Riza Putra Andrian"},
  {"kelas":"KELAS X AKL1","nama":"RizK1 Maulana Putra"},
  {"kelas":"KELAS X AKL1","nama":"RizK1 Putra Wardhana"},
  {"kelas":"KELAS X AKL1","nama":"Ri2K1 Tri Hadi Putra"},
  {"kelas":"KELAS X AKL1","nama":"Sandi Permana"},
  {"kelas":"KELAS X AKL1","nama":"Shofy Humairoh"},
  {"kelas":"KELAS X AKL1","nama":"Sigit Bagus Prayoga"},
  {"kelas":"KELAS X AKL1","nama":"Sigit Putra Ramadhan"},
  {"kelas":"KELAS X AKL1","nama":"Siti Hardianti"},
  {"kelas":"KELAS X AKL1","nama":"Syafa Syawalia"},
  {"kelas":"KELAS X AKL1","nama":"Talitha Salsabila"},
  {"kelas":"KELAS X AKL1","nama":"Wafda Nurahmah"},
  {"kelas":"KELAS X AKL1","nama":"Willjo Satriani"},
  {"kelas":"KELAS X AKL1","nama":"Yunita Nurohmawati"},
  {"kelas":"KELAS X AKL2","nama":"Aisyah Fitria"},
  {"kelas":"KELAS X AKL2","nama":"Amirah Parisya Anggraini"},
  {"kelas":"KELAS X AKL2","nama":"Anisa Dwi Febrjna"},
  {"kelas":"KELAS X AKL2","nama":"Anisah"},
  {"kelas":"KELAS X AKL2","nama":"Aqila Syahla Ramadhani"},
  {"kelas":"KELAS X AKL2","nama":"Aulia Nur Aini"},
  {"kelas":"KELAS X AKL2","nama":"Bening Makailla Hidayat"},
  {"kelas":"KELAS X AKL2","nama":"Chaesya Esa Claudia"},
  {"kelas":"KELAS X AKL2","nama":"Cikal Kirana Prasetyo"},
  {"kelas":"KELAS X AKL2","nama":"Citra Adinda"},
  {"kelas":"KELAS X AKL2","nama":"Dewi Paramitha Larasati"},
  {"kelas":"KELAS X AKL2","nama":"Dimas Wafiqia Dava"},
  {"kelas":"KELAS X AKL2","nama":"Eirine Queensa Elizabeth Kappuw"},
  {"kelas":"KELAS X AKL2","nama":"Fabiyan AzKa Anwar"},
  {"kelas":"KELAS X AKL2","nama":"Farhataini Nurfitri"},
  {"kelas":"KELAS X AKL2","nama":"Fatih Syamil"},
  {"kelas":"KELAS X AKL2","nama":"Haysya Juliana Putri"},
  {"kelas":"KELAS X AKL2","nama":"Heny Risky Aprillia"},
  {"kelas":"KELAS X AKL2","nama":"Humairah Fitri Ramadhani"},
  {"kelas":"KELAS X AKL2","nama":"Inka Putri Arvianti"},
  {"kelas":"KELAS X AKL2","nama":"Iza Azmi Athifa"},
  {"kelas":"KELAS X AKL2","nama":"Jesi Ramadini"},
  {"kelas":"KELAS X AKL2","nama":"Kanza Zahran Al Baihaqi"},
  {"kelas":"KELAS X AKL2","nama":"Khansa Kamiliya Shafa"},
  {"kelas":"KELAS X AKL2","nama":"Lubna Al-Ghiffarl"},
  {"kelas":"KELAS X AKL2","nama":"Lusi Sebriayani"},
  {"kelas":"KELAS X AKL2","nama":"Mahmud Ahmed Dinejat"},
  {"kelas":"KELAS X AKL2","nama":"Meyta Dini Haryanti"},
  {"kelas":"KELAS X AKL2","nama":"Muhamad Aditya Ramadan"},
  {"kelas":"KELAS X AKL2","nama":"Muhamad Faturahman As Sya'Bani"},
  {"kelas":"KELAS X AKL2","nama":"Muhamad Fikry Al Latief"},
  {"kelas":"KELAS X AKL2","nama":"Muhammad Hafjizhu Adzany"},
  {"kelas":"KELAS X AKL2","nama":"Nabila Husen"},
  {"kelas":"KELAS X AKL2","nama":"Nabilah Rahma"},
  {"kelas":"KELAS X AKL2","nama":"Nazwa Azqiya Ginanjar"},
  {"kelas":"KELAS X AKL2","nama":"Nazwa Maulidya"},
  {"kelas":"KELAS X AKL2","nama":"Niswatul Aziza"},
  {"kelas":"KELAS X AKL2","nama":"Nur Kayla"},
  {"kelas":"KELAS X AKL2","nama":"Putri Indah Agustina"},
  {"kelas":"KELAS X AKL2","nama":"Qotrunada Nirpataka Hibatullah"},
  {"kelas":"KELAS X AKL2","nama":"Rismawati"},
  {"kelas":"KELAS X AKL2","nama":"Safira Hayy Nurbaiti"},
  {"kelas":"KELAS X AKL2","nama":"Siti Nurul Hidayati"},
  {"kelas":"KELAS X AKL2","nama":"Suci Fitria Rahmadhani"},
  {"kelas":"KELAS X AKL2","nama":"Syakila Erdila Sari"},
  {"kelas":"KELAS X AKL2","nama":"Syifa Ghaziyah Anwar"},
  {"kelas":"KELAS X AKL2","nama":"Vera Cantika"},
  {"kelas":"KELAS X AKL2","nama":"Yeremia"},
  {"kelas":"KELAS X AKL2","nama":"Zivara Mabela Sesanti"},
  {"kelas":"KELAS X AKL3","nama":"Adilla Ramadani"},
  {"kelas":"KELAS X AKL3","nama":"Adinda Putri Nur Arief"},
  {"kelas":"KELAS X AKL3","nama":"Alisa Dwi Anggeraini"},
  {"kelas":"KELAS X AKL3","nama":"Almira Shaka Andrea"},
  {"kelas":"KELAS X AKL3","nama":"Alvina Rahma Novrianti"},
  {"kelas":"KELAS X AKL3","nama":"Alva Asyla Mukhbita"},
  {"kelas":"KELAS X AKL3","nama":"AnasyA"},
  {"kelas":"KELAS X AKL3","nama":"Asyifa Nurajni Aulia Leksono"},
  {"kelas":"KELAS X AKL3","nama":"Bima Sakti Rahmatulloh"},
  {"kelas":"KELAS X AKL3","nama":"Clariza Adya Nathaneila"},
  {"kelas":"KELAS X AKL3","nama":"Dela Maulida"},
  {"kelas":"KELAS X AKL3","nama":"Destari Aulia"},
  {"kelas":"KELAS X AKL3","nama":"Dhiha Mega Wangi Hidayat"},
  {"kelas":"KELAS X AKL3","nama":"Dhikaloka Rahma"},
  {"kelas":"KELAS X AKL3","nama":"Diana Syafitri"},
  {"kelas":"KELAS X AKL3","nama":"Dinara Anindytha Putri Pratiwi"},
  {"kelas":"KELAS X AKL3","nama":"Ervan Putra Pratama"},
  {"kelas":"KELAS X AKL3","nama":"Farisha Nur Maulida"},
  {"kelas":"KELAS X AKL3","nama":"Fathia Rizqiqa Amalia"},
  {"kelas":"KELAS X AKL3","nama":"Fayrus Chalisa Zulfa"},
  {"kelas":"KELAS X AKL3","nama":"Hana Alisa"},
  {"kelas":"KELAS X AKL3","nama":"Hilda Aryani"},
  {"kelas":"KELAS X AKL3","nama":"Indana Askia Putri"},
  {"kelas":"KELAS X AKL3","nama":"Indira Okta Vira"},
  {"kelas":"KELAS X AKL3","nama":"Iren Sakharina Sarfina Hady"},
  {"kelas":"KELAS X AKL3","nama":"Irma Suryani"},
  {"kelas":"KELAS X AKL3","nama":"Juanita"},
  {"kelas":"KELAS X AKL3","nama":"Keisha Audreylia Shafiqa"},
  {"kelas":"KELAS X AKL3","nama":"Marchello Tandian"},
  {"kelas":"KELAS X AKL3","nama":"Muhamad Saputra"},
  {"kelas":"KELAS X AKL3","nama":"Muhammad Azka Rayyan"},
  {"kelas":"KELAS X AKL3","nama":"Muhammad Havip"},
  {"kelas":"KELAS X AKL3","nama":"Muhammad Iqram Haryadi"},
  {"kelas":"KELAS X AKL3","nama":"Muhammad Rafky Alfarezi"},
  {"kelas":"KELAS X AKL3","nama":"Nadira Ayu Kusumaningtyas"},
  {"kelas":"KELAS X AKL3","nama":"Nadzwa Adelia Suherman"},
  {"kelas":"KELAS X AKL3","nama":"Nayla Asifa Syafira"},
  {"kelas":"KELAS X AKL3","nama":"Nur Nadiah"},
  {"kelas":"KELAS X AKL3","nama":"Rahelda Anaya Rasya"},
  {"kelas":"KELAS X AKL3","nama":"Ratu Erica Qurfania"},
  {"kelas":"KELAS X AKL3","nama":"Resty Audi"},
  {"kelas":"KELAS X AKL3","nama":"Rizka Nadya Fitri"},
  {"kelas":"KELAS X AKL3","nama":"Safa Asfia Almira"},
  {"kelas":"KELAS X AKL3","nama":"Salfa Ainur Rofikah"},
  {"kelas":"KELAS X AKL3","nama":"Sindi Septiani"},
  {"kelas":"KELAS X AKL3","nama":"Siti Revalina"},
  {"kelas":"KELAS X AKL3","nama":"Thalita Putri"},
  {"kelas":"KELAS X AKL3","nama":"Umroh Agustin"},
  {"kelas":"KELAS X AKL3","nama":"Zahra Yuanita Putri"},
  {"kelas":"KELAS X AKL4","nama":"Aila Junisa"},
  {"kelas":"KELAS X AKL4","nama":"Ajeng Pertiwi"},
  {"kelas":"KELAS X AKL4","nama":"Alya Putri Amanda"},
  {"kelas":"KELAS X AKL4","nama":"Anisa Putri"},
  {"kelas":"KELAS X AKL4","nama":"Arista Putri Kirana"},
  {"kelas":"KELAS X AKL4","nama":"Caturin Putri Fatimah"},
  {"kelas":"KELAS X AKL4","nama":"Dhea Kesya Novriyanti"},
  {"kelas":"KELAS X AKL4","nama":"Difa Julia Lestary"},
  {"kelas":"KELAS X AKL4","nama":"Dika Rahadea Nizar"},
  {"kelas":"KELAS X AKL4","nama":"Dinda Nuni Wulandari"},
  {"kelas":"KELAS X AKL4","nama":"Dwi Indriani"},
  {"kelas":"KELAS X AKL4","nama":"Fitri Nurkarimah"},
  {"kelas":"KELAS X AKL4","nama":"Ghina Rifqoh Chasanah"},
  {"kelas":"KELAS X AKL4","nama":"Jihan Khaerunisa"},
  {"kelas":"KELAS X AKL4","nama":"Kevin Rafif"},
  {"kelas":"KELAS X AKL4","nama":"Keyla Kanza Juliana"},
  {"kelas":"KELAS X AKL4","nama":"Keyla Siti Zahra"},
  {"kelas":"KELAS X AKL4","nama":"Khairul Ihwan"},
  {"kelas":"KELAS X AKL4","nama":"Khairunisa"},
  {"kelas":"KELAS X AKL4","nama":"Maharani Wanara"},
  {"kelas":"KELAS X AKL4","nama":"Maulana Malik Ibrahim"},
  {"kelas":"KELAS X AKL4","nama":"Meilina Wulandari"},
  {"kelas":"KELAS X AKL4","nama":"Melati Cahaya Ramadhani"},
  {"kelas":"KELAS X AKL4","nama":"Muhamad Fadly"},
  {"kelas":"KELAS X AKL4","nama":"Muhammad Delly Akbar"},
  {"kelas":"KELAS X AKL4","nama":"Muhammad Rizky Kurniawan"},
  {"kelas":"KELAS X AKL4","nama":"Naila Nur Azizah"},
  {"kelas":"KELAS X AKL4","nama":"Nindia Oktaviani Putri"},
  {"kelas":"KELAS X AKL4","nama":"Nur Kayna Adhalia"},
  {"kelas":"KELAS X AKL4","nama":"Putri Aisyah Rahman"},
  {"kelas":"KELAS X AKL4","nama":"Rafael Kenzi"},
  {"kelas":"KELAS X AKL4","nama":"Rahma Maulidya"},
  {"kelas":"KELAS X AKL4","nama":"Ratu Anzani Dwi Putri"},
  {"kelas":"KELAS X AKL4","nama":"Reyhana Putri Rahmadina"},
  {"kelas":"KELAS X AKL4","nama":"Rimba Al Musyaffa"},
  {"kelas":"KELAS X AKL4","nama":"Risma Putri Kirani"},
  {"kelas":"KELAS X AKL4","nama":"Rosmalina Wijayanti"},
  {"kelas":"KELAS X AKL4","nama":"Safa Azahra"},
  {"kelas":"KELAS X AKL4","nama":"Salwa Khoerunisa"},
  {"kelas":"KELAS X AKL4","nama":"Septiany Nur Aulia"},
  {"kelas":"KELAS X AKL4","nama":"Shelina Putri"},
  {"kelas":"KELAS X AKL4","nama":"Sherylua Puspa Westrj"},
  {"kelas":"KELAS X AKL4","nama":"Suci Aulina"},
  {"kelas":"KELAS X AKL4","nama":"Syifa Khoirunisa"},
  {"kelas":"KELAS X AKL4","nama":"Syifah Syafwah"},
  {"kelas":"KELAS X AKL4","nama":"Talita Sakhi"},
  {"kelas":"KELAS X AKL4","nama":"Tia Amelia"},
  {"kelas":"KELAS X AKL4","nama":"Zahirah Sarah Amirah"},
  {"kelas":"KELAS X AKL4","nama":"Zahra Assita"}
];

const ALL_QUESTIONS = {
    // Pertanyaan untuk Assessment as Learning
    "As Learning": [
        "Bagaimana Murid menyusun JURNAL REFLEKSI nya?", 
        "Bagaimana Murid MENGAITKAN KONSEP SPREADSHEET dengan materi yang dipelajari?", 
        "Bagaimana Murid menunjukkan KESADARAN DIRI terkait proses belajar (kesulitan, usaha, hasil)?", 
        "Bagaimana Murid menuliskan REFLEKSI MATERI terkait fungsi (logika, lookup, analisis data)?", 
        "Bagaimana Murid MENGAITKAN PENGALAMAN PRIBADI nya dengan pembelajaran spreadsheet?" 
    ],
    // Pertanyaan untuk Assessment for Learning
    "For Learning": [
        "Bagaimana Guru menilai KETERLIBATAN Murid dalam DISKUSI PROYEK?", 
        "Bagaimana Guru menilai PENGGUNAAN FITUR SPREADSHEET dalam PROYEK KELOMPOK?", 
        "Bagaimana Guru menilai KERJA SAMA TIM Murid selama mengerjakan proyek?", 
        "Bagaimana Guru menilai upaya PEMECAHAN MASALAH Murid saat menghadapi kendala proyek?", 
        "Bagaimana Guru MENGGUNAKAN UMPAN BALIK dari guru/teman untuk perbaikan?" 
    ],
    // Pertanyaan untuk Assessment of Learning
    "Of Learning": [
        "Bagaimana Guru menilai KUALITAS FILE SPREADSHEET (data, fungsi, relevansi)?", 
        "Bagaimana Guru menilai KETEPATAN PERHITUNGAN (rumus, logika, otomatisasi)?", 
        "Bagaimana Guru menilai KREATIVITAS DESAIN DAN PRESENTASI DATA?", 
        "Bagaimana Guru menilai KETERKAITAN DENGAN KEHIDUPAN NYATA (analisis, solusi)?", 
        "Bagaimana Guru menilai PRESENTASI DAN PENJELASAN PROYEK (struktur, hasil, refleksi)?" 
    ]
};

const ALL_OPTIONS = {
    // Opsi untuk Assessment as Learning (Prestructural-Extended Abstract)
    "As Learning": [
        ["Tidak menulis jurnal refleksi.", "Ada catatan satu aspek pengalaman belajar.", "Catatan mencakup beberapa aspek pengalaman pembelajaran.", "Catatan menyatukan seluruh aspek pembelajaran secara runtut.", "Catatan refleksi mendalam, menghasilkan ide baru untuk pembelajaran berikutnya."],
        ["Tidak mengaitkan dengan materi spreadsheet.", "Mengaitkan satu konsep dengan pengalaman.", "Mengaitkan beberapa konsep fungsi spreadsheet.", "Mengaitkan konsep-konsep dengan penerapan logika dan fungsi dalam kehidupan nyata.", "Mengembangkan pemikiran baru berdasarkan hubungan antar konsep spreadsheet."],
        ["Tidak menunjukkan kesadaran belajar.", "Menyebutkan satu kesadaran belajar.", "Menyebutkan beberapa kesadaran belajar terkait kesulitan dan keberhasilan.", "Menunjukkan pemahaman hubungan antara usaha dan hasil belajar.", "Menyusun rencana pengembangan diri berdasarkan refleksi."],
        ["Tidak menulis refleksi tentang materi spreadsheet.", "Menulis refleksi satu topik (misal fungsi logika IF).", "Menulis refleksi beberapa topik (fungsi logika, statistik).", "Menghubungkan topik-topik (fungsi logika + lookup + analisis data).", "Menghubungkan topik dengan situasi nyata (misal laporan keuangan pribadi)."],
        ["Tidak mengaitkan dengan pengalaman pribadi.", "Mengaitkan 1 pengalaman pribadi.", "Mengaitkan beberapa pengalaman pribadi.", "Mengaitkan pengalaman pribadi dengan tantangan belajar yang dihadapi.", "Mengaitkan pengalaman dan merencanakan tindakan untuk peningkatan hasil pribadi."]
    ],
    // Opsi untuk Assessment for Learning (Prestructural-Extended Abstract)
    "For Learning": [
        ["Tidak aktif dalam diskusi.", "Berpartisipasi pasif dalam satu sesi.", "Berpartisipasi aktif dalam beberapa sesi.", "Memberi masukan konstruktif kepada tim.", "Memimpin diskusi dan membantu teman memahami konsep."],
        ["Tidak menggunakan fitur spreadsheet.", "Menggunakan fungsi dasar (penjumlahan).", "Menggunakan beberapa fungsi logika dan statistik.", "Menggunakan fitur lanjutan seperti VLOOKUP/HLOOKUP secara efektif.", "Mengembangkan cara baru atau kombinasi fitur untuk efisiensi proyek."],
        ["Tidak bekerja sama.", "Melaksanakan tugas kecil dengan bimbingan.", "Bekerja sama dalam sebagian tahap proyek.", "Aktif membantu anggota tim lain.", "Menjadi fasilitator dan motivator dalam kelompok."],
        ["Tidak mencoba memecahkan masalah.", "Mencoba solusi sederhana tanpa hasil.", "Menyusun beberapa alternatif solusi.", "Memilih solusi yang paling sesuai dan menerapkannya.", "Menciptakan solusi inovatif untuk memperbaiki hasil proyek."],
        ["Tidak menanggapi umpan balik.", "Menerima umpan balik tanpa perubahan.", "Melakukan beberapa perbaikan kecil.", "Menerapkan umpan balik untuk peningkatan signifikan.", "Menggunakan umpan balik untuk merancang strategi belajar baru."]
    ],
    // Opsi untuk Assessment of Learning (Prestructural-Extended Abstract)
    "Of Learning": [
        ["File kosong/data tidak relevan.", "Mengandung data sederhana tanpa fungsi.", "Menggunakan beberapa fungsi dasar (SUM, AVERAGE).", "Menggunakan fungsi logika dan lookup secara benar.", "Menggabungkan berbagai fungsi kompleks untuk analisis data keuangan yang akurat."],
        ["Banyak kesalahan perhitungan.", "Ada beberapa kesalahan kecil.", "Perhitungan sebagian besar benar.", "Semua perhitungan benar dan logis.", "Perhitungan akurat dan efisien dengan otomatisasi (misal kombinasi fungsi)."],
        ["Tabel tidak terstruktur.", "Ada format dasar (tabel/sheet sederhana).", "Format rapi dengan beberapa fitur tampilan (warna, border).", "Tampilan profesional dengan visualisasi sederhana (grafik, conditional formatting).", "Desain menarik, interaktif, dan komunikatif (dashboard, hyperlink, visual dinamis)."],
        ["Tidak relevan dengan konteks kehidupan siswa.", "Mengaitkan sedikit dengan contoh sehari-hari.", "Mengaitkan dengan konteks sekolah (misal laporan keuangan koperasi).", "Mengaitkan dengan dunia nyata (misal analisis pengeluaran pribadi).", "Menghasilkan solusi kreatif yang dapat digunakan dalam kehidupan nyata."],
        ["Tidak mampu menjelaskan hasil proyek.", "Menjelaskan sebagian data tanpa makna.", "Menjelaskan struktur dan hasil dengan bantuan guru.", "Menjelaskan hubungan antar data dan fungsi secara logis.", "Menyampaikan penjelasan reflektif, inspiratif, dan mampu menjawab pertanyaan mendalam."]
    ]
};

const qContainer=document.getElementById('questions');
const sesiSelect = document.getElementById('sesi');
const sesiAlert = document.getElementById('sesi-alert'); 
let current=0;
let currentQuestions = []; 

sesiSelect.addEventListener('change', loadQuestions);

function loadQuestions() {
    const selectedSesi = sesiSelect.value;
    qContainer.innerHTML = ''; 
    document.getElementById('fixedNavButtons').innerHTML = ''; 
    current = 0; 
    currentQuestions = []; 

    if (!selectedSesi) {
        return;
    }
    
    currentQuestions = ALL_QUESTIONS[selectedSesi];

    if (!currentQuestions || currentQuestions.length === 0) {
        return;
    }

    createQuestions(selectedSesi);
    generateFixedNav();
    show(0);
}

function createQuestions(sesiKey){
  const questionsToUse = ALL_QUESTIONS[sesiKey];
  const optionsToUse = ALL_OPTIONS[sesiKey];

  for(let i=0;i<questionsToUse.length;i++){
    const card=document.createElement('div');
    card.className='question-card';
    card.id='q'+i;
    card.style.display='none';

    const q=document.createElement('p');
    q.className='q-text';
    q.textContent=(i+1)+'. '+questionsToUse[i];
    card.appendChild(q);
    
    const optWrap=document.createElement('div');
    optWrap.className='options';
    (optionsToUse[i]).forEach((op,j)=>{
      const label=document.createElement('label');
      label.className='opt';
      
      const input=document.createElement('input');
      input.type='radio';input.name='q'+i;input.value=j+1; 
      
      input.addEventListener('change', function() {
          label.parentElement.querySelectorAll('.opt').forEach(l => l.classList.remove('checked-option'));
          if (this.checked) {
              label.classList.add('checked-option');
          }
          updateNav();
      });
      
      const span=document.createElement('span');
      span.textContent=op;
      
      label.appendChild(input);
      label.appendChild(span);
      optWrap.appendChild(label);
    });
    card.appendChild(optWrap);

    qContainer.appendChild(card);
  }
}

function generateFixedNav() {
    const navContainer = document.getElementById('fixedNavButtons');
    for(let n=0; n < currentQuestions.length; n++) {
        const btn = document.createElement('button');
        btn.textContent = n + 1;
        btn.type = 'button';
        btn.onclick = () => show(n);
        navContainer.appendChild(btn);
    }
}


function show(i){
  document.querySelectorAll('.question-card').forEach(c=>c.style.display='none');
  const currentCard = document.getElementById('q'+i);
  if (currentCard) {
      currentCard.style.display='block';
      current=i;
      updateNav();
      window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}

function updateNav(){
  const btns = document.getElementById('fixedNavButtons').querySelectorAll('button');
  
  btns.forEach((b,i)=>{
    const radio = document.querySelector('input[name="q'+i+'"]:checked');
    const answered=!!radio;
    
    if (i === current) {
        b.classList.add('current-q');
    } else {
        b.classList.remove('current-q');
    }

    // Hanya ubah warna jika dijawab
    if (answered) {
        b.style.background = 'var(--accent)';
        b.style.color = '#fff';
        // Pastikan opsi yang dipilih tetap ditandai (diperlukan untuk navigasi)
        document.querySelectorAll('label.opt input[name="q'+i+'"]').forEach(r => {
             r.parentElement.classList.remove('checked-option');
             if (r.checked) {
                r.parentElement.classList.add('checked-option');
             }
        });
    } else { // Belum dijawab
        b.style.background = '#d8e8ff';
        b.style.color = '#0056b3';
        document.querySelectorAll('label.opt input[name="q'+i+'"]').forEach(r => r.parentElement.classList.remove('checked-option'));
    }
  });
}
// URL Script Google Apps Script untuk mengambil data nilai
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbxe1KHyxGBwPg5tQ7dIztRMX7cttmp0LN1u0R1_b9o08RjBXaA0ewZCgMjC9xWIypZD/exec";
let currentClassData=[]; 

document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('kelas').addEventListener('change',onKelasChange);
  document.getElementById('nama').addEventListener('change',onNamaChange); 
  
  document.getElementById('btnReset').addEventListener('click', resetFormAndUI);

  updateNamaList(); 
  
  // START: LOGIKA BARU FLOATING DROPDOWN MENU
  const menuBtn = document.getElementById('menu-btn');
  const floatingMenu = document.getElementById('floating-menu');

  menuBtn.addEventListener('click', function(event) {
      event.stopPropagation(); // Mencegah klik menyebar ke window
      
      const isHidden = floatingMenu.style.display === 'none' || floatingMenu.style.display === '';
      floatingMenu.style.display = isHidden ? 'block' : 'none';

      if (isHidden) {
          setTimeout(() => { 
              window.addEventListener('click', closeFloatingMenu, { once: true });
          }, 50);
      }
  });

  function closeFloatingMenu(event) {
      if (floatingMenu.contains(event.target) || event.target === menuBtn) {
          window.addEventListener('click', closeFloatingMenu, { once: true });
          return;
      }
      floatingMenu.style.display = 'none';
  }

  floatingMenu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
          floatingMenu.style.display = 'none';
      });
  });
  // END: LOGIKA BARU FLOATING DROPDOWN MENU
});

// FUNGSI INI DIUBAH UNTUK MENGISI ELEMEN <SELECT>
function updateNamaList() {
    const selectedKelas = document.getElementById('kelas').value;
    const selectNama = document.getElementById('nama'); // Target sekarang adalah elemen <select>

    // Bersihkan opsi lama
    selectNama.innerHTML = ''; 
    
    // Tambahkan opsi default/placeholder
    const defaultOption = document.createElement('option');
    defaultOption.value = "";
    defaultOption.textContent = selectedKelas ? `-- Pilih Nama Peserta Didik --` : 'Pilih Kelas dahulu';
    defaultOption.disabled = true;
    defaultOption.selected = true;
    selectNama.appendChild(defaultOption);

    if (!selectedKelas) {
        // FIX: Update mobile fake button text for 'nama' if no class is selected
        if (window.innerWidth <= 640) {
            const fakeBtn = selectNama.previousElementSibling;
            if (fakeBtn && fakeBtn.classList.contains('fake-select-btn')) {
                fakeBtn.textContent = 'Pilih Kelas dahulu';
            }
        }
        return; 
    }
    
    // Filter data siswa
    const filteredStudents = ALL_STUDENTS_DATA.filter(student => 
        student.kelas === selectedKelas 
    );

    // Tambahkan nama ke select
    if (filteredStudents.length > 0) {
        filteredStudents.forEach(student => {
            const option = document.createElement('option');
            option.value = student.nama; // Value dan textContent diisi nama
            option.textContent = student.nama; 
            selectNama.appendChild(option);
        });
    } else {
         defaultOption.textContent = `Tidak ada data nama ditemukan untuk ${selectedKelas}`;
    }
}


// --- FUNGSI UTAMA YANG DIMODIFIKASI UNTUK FORMAT NILAI ---
function applyScoreStyle(elementId, value) {
    const element = document.getElementById(elementId);
    if (!element) return;

    // Bersihkan nilai sebelumnya
    element.textContent = value || '-';
    element.classList.remove('pass');

    // Cek apakah nilai adalah angka valid dan >= 80
    const numValue = parseFloat(value);
    if (!isNaN(numValue) && numValue >= 80) {
        element.classList.add('pass'); // Tambahkan class 'pass' untuk style hijau tebal
    }
}

function fetchAndDisplayScore(kelas) {
    const namaSelect = document.getElementById('nama');
    const selectedNama = namaSelect.value.trim().toLowerCase();

    // Gunakan fungsi applyScoreStyle untuk membersihkan tampilan
    applyScoreStyle('score-as', '-');
    applyScoreStyle('score-for', '-');
    applyScoreStyle('score-of', '-');
    applyScoreStyle('score-akhir', '-');

    if (!kelas) return;

    let targetKelasQuery = kelas;

    // Ambil data nilai dari Google Sheet berdasarkan kelas yang dipilih
    fetch(SCRIPT_URL+'?kelas='+encodeURIComponent(targetKelasQuery))
    .then(r=>r.json())
    .then(d=>{
        currentClassData=d; // Perbarui data kelas
        
        // Tampilkan nilai siswa yang sedang dipilih (jika nama sudah dipilih)
        if (selectedNama) {
            const siswaBaru = d.find(x => x.nama.toLowerCase() === selectedNama);
            if (siswaBaru) {
                applyScoreStyle('score-as', siswaBaru.as || siswaBaru["As Learning (20%)"]);
                applyScoreStyle('score-for', siswaBaru.for || siswaBaru["For Learning (30%)"]);
                applyScoreStyle('score-of', siswaBaru.of || siswaBaru["Of Learning (50%)"]);
                applyScoreStyle('score-akhir', siswaBaru.akhir || siswaBaru["Nilai Akhir"]);
            } else {
                // Siswa tidak ditemukan di data nilai yang baru
                applyScoreStyle('score-as', '-');
                applyScoreStyle('score-for', '-');
                applyScoreStyle('score-of', '-');
                applyScoreStyle('score-akhir', '-');
            }
        }
    })
    .catch(error => {
        console.error('Error fetching data:', error);
        Swal.fire({
            icon: 'error',
            title: 'Gagal Memuat Data!',
            text: 'Tidak dapat mengambil data nilai dari server. Cek koneksi atau URL script.',
            confirmButtonColor: '#d33'
        });
    });
}
// --- AKHIR FUNGSI UTAMA YANG DIMODIFIKASI ---


// Fungsi yang dipanggil saat memilih Kelas (Telah Diubah)
function onKelasChange(e){
  const k=e.target.value;
  document.getElementById('nama').value = ''; 
  updateNamaList(); 

  // Reset nilai yang ditampilkan sebelum fetch data baru
  applyScoreStyle('score-as', '-');
  applyScoreStyle('score-for', '-');
  applyScoreStyle('score-of', '-');
  applyScoreStyle('score-akhir', '-');

  // Panggil fetchAndDisplayScore untuk memuat data kelas
  if (k) {
      fetchAndDisplayScore(k);
  } else {
      currentClassData = []; // Kosongkan data kelas jika kelas direset
  }
}

// FUNGSI INI DIUBAH (dulu onNamaInput, sekarang onNamaChange)
function onNamaChange(e){
  const n=e.target.value.trim().toLowerCase();
  const k=document.getElementById('kelas').value; 
  

  if (!n || !k) { 
      applyScoreStyle('score-as', '-');
      applyScoreStyle('score-for', '-');
      applyScoreStyle('score-of', '-');
      applyScoreStyle('score-akhir', '-');
      return;
  }
  
  // Jika currentClassData kosong, coba ambil data (ini akan memanggil kembali onNamaChange secara efektif)
  if (currentClassData.length === 0) {
      fetchAndDisplayScore(k);
      return;
  }

  // Cari siswa di data yang sudah dimuat (currentClassData)
  const s=currentClassData.find(x=>x.nama.toLowerCase()===n);
  
  if(!s){
      applyScoreStyle('score-as', '-');
      applyScoreStyle('score-for', '-');
      applyScoreStyle('score-of', '-');
      applyScoreStyle('score-akhir', '-');
      return;
  }
  
  // Tampilkan nilai (menggunakan fungsi applyScoreStyle)
  applyScoreStyle('score-as', s.as||s["As Learning (20%)"]);
  applyScoreStyle('score-for', s.for||s["For Learning (30%)"]);
  applyScoreStyle('score-of', s.of||s["Of Learning (50%)"]);
  applyScoreStyle('score-akhir', s.akhir||s["Nilai Akhir"]);
}

// Fungsi Reset Nilai (As, For, Of, Akhir)
function resetScorePills() {
    applyScoreStyle('score-as', '-');
    applyScoreStyle('score-for', '-');
    applyScoreStyle('score-of', '-');
    applyScoreStyle('score-akhir', '-');
}


// Clear only rubric answers and navigation, keep identity and score pills intact
function clearRubrikAnswers() {
    // Uncheck all radios and remove checked-option styling
    document.querySelectorAll('.opt').forEach(l => {
        const r = l.querySelector('input[type="radio"]');
        if (r) r.checked = false;
        l.classList.remove('checked-option');
    });
    // Clear question cards and navigation but keep identity selects and score pills
    const qContainer = document.getElementById('questions');
    if (qContainer) qContainer.innerHTML = '';
    const nav = document.getElementById('fixedNavButtons');
    if (nav) nav.innerHTML = '';
    currentQuestions = [];
    current = 0;
    updateNav();
}


// FUNGSI INI TELAH DIPERBAIKI (FIXED)
function performReset() {
    const form = document.getElementById('refleksiForm');
    form.reset();
    
    const kelasSelect = document.getElementById('kelas');
    const sesiSelect = document.getElementById('sesi');
    const namaSelect = document.getElementById('nama');

    // 1. Reset values in HTML Selects
    kelasSelect.value = ''; 
    sesiSelect.value = ''; 
    namaSelect.value = ''; 
    
    // 2. FIX: Reset visible UI for mobile patch (fake buttons)
    if (window.innerWidth <= 640) {
        const resetFakeButton = (selectElement) => {
            const fakeBtn = selectElement.previousElementSibling;
            if (fakeBtn && fakeBtn.classList.contains('fake-select-btn')) {
                // Get the text of the first option (placeholder)
                fakeBtn.textContent = selectElement.options[0].textContent;
            }
        };
        resetFakeButton(kelasSelect); // Set ke 'Pilih Kelas'
        resetFakeButton(sesiSelect);  // Set ke 'Pilih Asesmen'
        // Untuk 'nama', teks akan diupdate oleh updateNamaList() nanti, tapi kita reset juga di sini
        resetFakeButton(namaSelect);
    }
    
    // 3. Reset Score Pills
    resetScorePills();
    
    // 4. Clear Rubrik Answers
    document.querySelectorAll('.opt').forEach(l => {
        l.classList.remove('checked-option');
        const radio = l.querySelector('input[type="radio"]');
        if (radio) radio.checked = false;
    });
    
    // 5. Clear Questions/Navigation
    qContainer.innerHTML = ''; 
    document.getElementById('fixedNavButtons').innerHTML = ''; 
    currentQuestions = [];
    
    // 6. Update Nama List (untuk memastikan menampilkan 'Pilih Kelas dahulu')
    updateNamaList();
    
    current = 0;
}

// Fungsi yang dipanggil oleh tombol RESET (dengan konfirmasi)
function resetFormAndUI() {
    Swal.fire({
        title: 'Anda yakin?',
        text: "Semua isian rubrik dan identitas akan dihapus!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ya, Reset Data!'
    }).then((result) => {
        if (result.isConfirmed) {
            performReset(); // Menggunakan performReset yang mengosongkan semua
            Swal.fire(
                'Direset!',
                'Semua isian telah dihapus.',
                'success'
            );
        }
    });
}

// LOGIKA NAVIGASI DAN KIRIM DATA
document.getElementById('btnNext').onclick=()=>{
  // Jika Sesi belum dipilih
  if(!document.getElementById('sesi').value){
      Swal.fire({
          icon: 'warning',
          title: 'Perhatian!',
          text: 'Harap pilih Sesi Refleksi (As/For/Of Learning) terlebih dahulu.',
          confirmButtonColor: '#007bff'
      }).then(() => {
          document.getElementById('sesi').focus(); 
      });
      return;
  }
    
  // Jika tombol masih berlabel "KIRIM RUBRIK" dan semua soal sudah dijawab
  if(currentQuestions.length > 0 && current === currentQuestions.length-1){
    let allAnswered = true;
    let firstUnansweredIndex = -1;
    for(let i=0; i<currentQuestions.length; i++) {
        if (!document.querySelector('input[name="q'+i+'"]:checked')) {
            allAnswered = false;
            firstUnansweredIndex = i;
            break;
        }
    }
    
    if (allAnswered) {
        sendData(); 
    } else {
        Swal.fire({
            icon: 'warning',
            title: 'Refleksi Belum Lengkap!',
            text: 'Harap jawab semua pertanyaan sebelum mengirim. Pertanyaan ' + (firstUnansweredIndex + 1) + ' belum dijawab.',
            confirmButtonColor: '#007bff'
        }).then(() => {
             show(firstUnansweredIndex);
        });
    }
  } 
  // Jika tombol berlabel "KIRIM RUBRIK" dan belum di soal terakhir
  else if (currentQuestions.length > 0 && current < currentQuestions.length - 1) {
    show(current + 1); 
  } else if (currentQuestions.length === 0) {
      Swal.fire({
          icon: 'warning',
          title: 'Perhatian!',
          text: 'Harap pilih Sesi Refleksi (As/For/Of Learning) terlebih dahulu untuk memuat pertanyaan.',
          confirmButtonColor: '#007bff'
      }).then(() => {
          document.getElementById('sesi').focus(); 
      });
  }
};


function sendData(){
  const nama=document.getElementById('nama').value.trim();
  const kelas=document.getElementById('kelas').value;
  const sesi=document.getElementById('sesi').value;
  const btnSend = document.getElementById('btnNext');

  if(!nama||!kelas||!sesi){
      Swal.fire({
          icon: 'warning',
          title: 'Perhatian!',
          text: 'Harap lengkapi identitas (Nama, Kelas, dan Sesi) terlebih dahulu.',
          confirmButtonColor: '#007bff'
      }).then(() => {
          document.getElementById('nama').focus(); 
      });
      return;
  }

  const form=document.getElementById('refleksiForm');
  const fd=new FormData(form);
  fd.append('nama', nama);
  fd.append('kelas', kelas);
  fd.append('sesi', sesi);
  
  // Tambahkan jawaban yang tidak terpilih dengan nilai '0'
  for(let i=0;i<currentQuestions.length;i++){
      if(!fd.has('q'+i)) fd.append('q'+i,'0');
  }

  const params = new URLSearchParams();
  fd.forEach((v, k) => params.append(k, v));
  
  // Tampilkan loading SweetAlert2
  Swal.fire({
    title: 'Mengirim Rubrik...',
    text: 'Mohon tunggu, data sedang diproses.',
    allowOutsideClick: false,
    didOpen: () => {
      Swal.showLoading();
    }
  });

  btnSend.textContent = 'Mengirim...';
  btnSend.disabled = true;


  fetch(form.action, {
    method: 'POST',
    mode: 'cors',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: params
  })
  .then(res => res.text())
  .then(txt => {
    Swal.close(); 
    
    // Periksa respons dari Google Apps Script (Asumsi 'SUKSES_APEND_BERHASIL' dikirim dari GAS)
    if (txt.includes('SUKSES_APEND_BERHASIL')) {
        // Notifikasi Sukses
        Swal.fire({
            icon: 'success',
            title: 'Berhasil!',
            text: 'Rubrik berhasil terkirim dan data Anda sudah terekam.',
            confirmButtonColor: '#007bff'
        }).then(() => {
            
            // --- PERUBAHAN UTAMA: Panggil fungsi fetchAndDisplayScore untuk memperbarui nilai REALTIME ---
            const kelas = document.getElementById('kelas').value;
            fetchAndDisplayScore(kelas);

            // Panggil fungsi reset rubrik
            clearRubrikAnswers(); 
        });
        
    } else {
        // Notifikasi Gagal Server
        Swal.fire({
            icon: 'error',
            title: 'Gagal Kirim!',
            html: 'Pengiriman data GAGAL di sisi server. Cek kembali URL Web App dan izin Anda. <br><br>Pesan Server: <b>' + txt.substring(0, 100) + '...</b>',
            confirmButtonColor: '#d33'
        });
    }
    
    btnSend.textContent = 'KIRIM RUBRIK';
    btnSend.disabled = false;
    updateNav(); 
  })
  .catch(err => {
    Swal.close(); 
    // Notifikasi Gagal Koneksi
    Swal.fire({
        icon: 'error',
        title: 'Gagal Koneksi!',
        text: 'Tidak dapat mengirim data. Cek koneksi internet Anda. Rincian: ' + err.message,
        confirmButtonColor: '#d33'
    });
    
    btnSend.textContent = 'KIRIM RUBRIK';
    btnSend.disabled = false;
    updateNav();
  });
}
</script>

<script>
// Floating dropdown mobile patch
if(window.innerWidth <= 640){
  document.querySelectorAll('select').forEach(sel=>{
    sel.classList.add('mobile-hidden'); sel.style.opacity='0'; sel.style.position='absolute'; sel.style.pointerEvents='none';
    const fakeBtn=document.createElement('div'); fakeBtn.className='fake-select-btn'; fakeBtn.textContent= sel.options[sel.selectedIndex]?.textContent || 'Pilih Opsi'; fakeBtn.style.padding='10px'; fakeBtn.style.border='1px solid #ccc'; fakeBtn.style.borderRadius='6px'; fakeBtn.style.background='#fff'; fakeBtn.style.boxShadow='0 2px 4px rgba(0,0,0,0.15)'; fakeBtn.style.cursor='pointer'; fakeBtn.style.position='relative'; fakeBtn.style.marginBottom='6px'; sel.parentNode.insertBefore(fakeBtn, sel);
    fakeBtn.addEventListener('click', function(e){ e.preventDefault();
      const dropdown = document.createElement('div');
      const rect = fakeBtn.getBoundingClientRect(); dropdown.style.position='absolute'; dropdown.style.top = (rect.bottom + window.scrollY) + 'px'; dropdown.style.left = (rect.left + window.scrollX) + 'px'; dropdown.style.width = rect.width + 'px'; dropdown.style.maxHeight='60vh'; dropdown.style.overflow='auto'; dropdown.style.background='#fff'; dropdown.style.border='1px solid #ddd'; dropdown.style.borderRadius='8px'; dropdown.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; dropdown.style.zIndex='9999';
      const searchWrap=document.createElement('div'); searchWrap.style.padding='8px'; const searchInput=document.createElement('input'); searchInput.type='text'; searchInput.placeholder='Cari...'; searchInput.style.width='100%'; searchInput.style.padding='6px'; searchInput.style.border='1px solid #ddd'; searchInput.style.borderRadius='6px'; searchWrap.appendChild(searchInput); dropdown.appendChild(searchWrap);
      Array.from(sel.options).forEach((opt, idx)=>{ const item=document.createElement('div'); item.textContent=opt.textContent; item.style.padding='10px'; item.style.borderBottom='1px solid #f1f1f1'; item.style.cursor='pointer'; 
      
      item.addEventListener('click', ()=>{ 
          sel.selectedIndex = idx; 
          sel.dispatchEvent(new Event('change')); 
          fakeBtn.textContent = opt.textContent; // Update the visible text
          document.body.removeChild(dropdown); 
      }); 
      
      dropdown.appendChild(item); });
      document.body.appendChild(dropdown);
      searchInput.addEventListener('input', ()=>{ const q=searchInput.value.toLowerCase(); Array.from(dropdown.children).forEach((child,i)=>{ if(i===0) return; child.style.display = child.textContent.toLowerCase().includes(q)?'block':'none'; }); });
      setTimeout(()=>{ document.addEventListener('click', function handler(ev){ if(!dropdown.contains(ev.target) && ev.target!==fakeBtn){ if(document.body.contains(dropdown)) document.body.removeChild(dropdown); document.removeEventListener('click', handler); } }); },50);
    });
  });
}
</script>
</body>
</html>
